<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">

<head>
    <title></title>
    <meta charset="utf-8">
    <meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link rel="stylesheet" href="../build/css/fonts/font-awesome.min.css">
    <link rel="stylesheet" href="../build/css/ui-box.css">
    <link rel="stylesheet" href="../build/css/ui-base.css">
    <link rel="stylesheet" href="../build/css/ui-color.css">
    <link rel="stylesheet" href="../build/css/appcan.icon.css">
    <link rel="stylesheet" href="../build/css/appcan.control.css">
    <link rel="stylesheet" type="text/css" href="../ordermgmt/css/ordermgmt.css" />
    <link rel="stylesheet" type="text/css" href="css/delivery.css" />

</head>

<body id="nodata" class="bc-bg ub-f1 tx-l umar-t content-info" ontouchstart>
    <div id="content">

    </div>
    <div id="update" class="ub ub-ac ub-pc">
        <div class="btn ub ub-ac ub-pc bc-text-head bc-btn uc-a1 mp-btn" id="submit">
            分单提交
        </div>
    </div>


</body>
<script type="text/html" charset="utf-8" id="fenti">

    {{each list}}
    <div id='list" + i + "' class='list-content white-bg'>
        <div id='orderlist" + i + "'>

            <div id='' class='ub ub-ac umar-a m-row3'>
                <span class='gray-font'>付油通知单号&nbsp;&nbsp;</span>
                <span>
                    {{$value.noticeCode}}
                </span>
            </div>

            <div id='pay' class='ub ub-ac umar-l umar-r m-row3'>
                <div id='' class='col-left'>
                    <span class='gray-font'>油品名称&nbsp;&nbsp;</span>
                    <span>
                        {{$value.oilinfoName}}
                    </span>
                </div>
                <div id='total' class='col-right'>
                    <span class='gray-font'>油品数量&nbsp;&nbsp;</span>
                    <span class='mf-color AllPrice'>
                        {{$value.count}}
                    </span>
                    <span class='gray-font mf-size2'>/吨</span>
                </div>
            </div>
            <div id='pay' class='ub ub-ac umar-l umar-r m-row3'>
                <span class="gray-font ulev0">
                    &nbsp;操作
                </span>
                <div id="action{{$index}}">
                    <div class='ub ub-ac ub-pe m-row4'>
                        <span data-noticesubId={{$value.noticesubId}} data-oilinfoId={{$value.oilinfoId}} data-index={{$index}} class='y-font umar-l'
                            id='zidingyiDetails' onclick="zidingyiDetails(this)">自定义</span>
                    </div>
                </div>
            </div>
        </div>

    </div>
    </div>
    <div class='gap'></div>
    {{/each}}
</script>
<script src="../build/js/appcan.js"></script>
<script src="../build/js/appcan.control.js"></script>
<script src="../common/template-web.js" type="text/javascript" charset="utf-8"></script>
<script src="../common/comm.js"></script>

<script>
    var fentiData = JSON.parse(getVal("fentiData"));
    var fentiType = fentiData.type; // 配送，自提
    // 确定分提单是配送 or 自提
    appcan.locStorage.setVal("fentiType", fentiType);
    var renderData = fentiData.baseParam.split(',');
    var showData = fentiData.showData;
    var isOnce = true;

    /*     pagerParam["baseParam"] = newParam;
        pagerParam["length"] = pager;

        pagerParam["url"] = url; */
    appcan.ready(function () {
        mentionOil.init();
    })
    var mentionOil = {
        init: function () {
            var yue = this;
            yue.renderHtml();
            appcan.button("#submit", "ani-act", function () {
                yue.submitFn();
            });
        },
        renderHtml: function () {
            var ahtml = template('fenti', {
                list: showData
            });
            document.getElementById('content').innerHTML = ahtml;
        },

        submitFn: function () {
            var yue = this;
            var func = yue.submitFnCallback.bind(yue);

            if (fentiType === "配送") {
                var peisongParam = appcan.locStorage.getVal("peisongParam");
                var paramJsonStr = "oils=" + peisongParam;
            } else if (fentiType === "自提") {
                var zitiParam = appcan.locStorage.getVal("zitiParam");
                var paramJsonStr = "oils=" + zitiParam;
            }

            var zitiParam = appcan.locStorage.getVal("zitiParam");


            var url = fentiData.url;
            if (isOnce) {
                ajaxPostQuery(url, paramJsonStr, func, "text");
                appcan.window.openToast('加载中...', '0', '5', '1');
                isOnce = false;
            }


        },
        submitFnCallback: function (data) {
            appcan.window.closeToast();
            var text = fentiType === "配送" ? "配送申请提交成功" : "自提申请提交成功";
            if (data != "") {
                oneAlert(text, "确定", function () {
                    uexWindow.evaluateScript("fendan", 0, "closePage()");
                })
            } else {
                var toast = fentiType === "配送" ? "配送申请提交失败，请重试" : "自提申请提交失败，请重试";
                uexWindow.alert("提示", toast, "确定");
            }
        }
    }

    function zidingyiDetails(that) {
        var itemData = that.dataset;
        appcan.locStorage.setVal("data-noticesubId", itemData.noticesubid);
        appcan.locStorage.setVal("data-fentiIndex", itemData.index);
        if (fentiType === "配送") {
            appcan.window.open("zidingyi", "zidingyi.html", 10);

        } else if (fentiType === "自提") {
            appcan.window.open("ztzidingyi", "ztzidingyi.html", 10);
        }
    }
</script>

</html>