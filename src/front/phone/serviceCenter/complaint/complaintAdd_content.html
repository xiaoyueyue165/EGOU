<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">

<head>
    <title></title>
    <meta charset="utf-8">
    <meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link rel="stylesheet" href="../../build/css/fonts/font-awesome.min.css">
    <link rel="stylesheet" href="../../build/css/ui-box.css">
    <link rel="stylesheet" href="../../build/css/ui-base.css">
    <link rel="stylesheet" href="../../build/css/ui-color.css">
    <link rel="stylesheet" href="../../build/css/appcan.icon.css">
    <link rel="stylesheet" href="../../build/css/appcan.control.css">
    <link rel="stylesheet" href="css/complaint.css">
</head>

<body class="um-vp white-bg" ontouchstart onload="showTypeParam()">

    <div class="ub ub-ver white-bg mf-size1" id="driverInfo">
        <div class="ub m-row umar-l umar-r">
            <div class="ub ub-ac l-width">
                <span class="gray-font">标题</span>
            </div>
            <div class="ub ub-ac ub-f1">
                <div class="uinput ub ub-f1">
                    <input placeholder="请输入标题" type="text" class="ub-f1" value="">
                </div>
            </div>
        </div>
        <div class="ub m-row umar-l umar-r">
            <div class="ub ub-ac l-width">
                <span class="gray-font">类型</span>
            </div>
            <div class="ub ub-ac ub-f1" onclick="chooseType()">
                <div id="catype" class="uinput ub ub-f1">
                    请选择
                </div>
                <div class="fa fa-angle-down fa-2x gray-font"></div>
            </div>
        </div>
        <div class="ub m-row umar-l umar-r">
            <div class="ub ub-ac l-width">
                <span class="gray-font">内容类型</span>
            </div>
            <div class="ub ub-ac ub-f1" onclick="chooseConType()">
                <div id="cacontype" class="uinput ub ub-f1">
                    请选择
                </div>
                <div class="fa fa-angle-right fa-2x gray-font"></div>
            </div>
        </div>
        <div class="ub ub-ver no-border-b">
            <div class="m-row2 gray-font">
                留言内容
            </div>
            <div class="umar-l">
                <textarea class="m-textarea" oninput="" onpropertychange=""></textarea>
            </div>
        </div>
    </div>

    <div class="umar-a margin-t-l">
        <div class="btn ub ub-ac bc-text-head ub-pc bc-btn mp-btn" id="btn-save-ca">
            提&nbsp; &nbsp;交
        </div>
    </div>

    <script src="../../build/js/appcan.js"></script>
    <script src="../../build/js/appcan.control.js"></script>
    <script src="../../common/comm.js"></script>
</body>
<script>
    var caContType = "";
    var caType = "";
    showTypeParam();

    appcan.ready(function () {
        appcan.window.subscribe("typeParam", function (typeParam) {
            if (typeParam == "") {
                $("#cacontype")[0].innerHTML = "";
                caContType = "请选择";
            } else {
                $("#cacontype")[0].innerHTML = typeParam.split("&")[1];
                caContType = typeParam.split("&")[0];
            }
        })

        appcan.window.subscribe("comType", function (comType) {
            if (comType == "0") {
                caType = "0";
                $("#catype")[0].innerHTML = "投诉";
            } else {
                caType = "1";
                $("#catype")[0].innerHTML = "建议";
            }
        })
    });

    function chooseConType() {
        appcan.window.open("caConType", "caConType.html", 10);
    }

    function chooseType() {
        uexWindow.evaluateScript("complaintAdd", 0, "chooseCAType()");
    }

    function showTypeParam() {

        var typeParam = appcan.locStorage.getVal("typeParam");
        if (typeParam) {

            $("#cacontype")[0].innerHTML = typeParam.split("&")[1];
            caContType = typeParam.split("&")[0];
        }
    }


    appcan.button("#btn-save-ca", "btn-act", function () {
        var title = $("input")[0].value;
        if (title == "") {
            uexWindow.alert("提示", "请输入标题！", "确定");
            return;
        }
        if (caType == "" || caType == "undefined") {
            uexWindow.alert("提示", "请选择类型！", "确定");
            return;
        }
        if (caContType == "" || caContType == "请选择") {
            uexWindow.alert("提示", "请选择内容类型！", "确定");
            return;
        }
        var content = $("textarea")[0].value;
        if (content == "") {
            uexWindow.alert("提示", "请输入内容！", "确定");
            return;
        }

        var param = "caTitle=" + $("input")[0].value + "&caType=" + caType + "&caContType=" + caContType +
            "&caContent=" + $("textarea")[0].value;

        var url = URL + "/app/complanit/addComplanitAdvice";
        var paramJsonStr = param;
        var func = addComplaintCallBack;
        var dataType = "text";
        ajaxPostQuery(url, paramJsonStr, func, dataType);
        appcan.window.openToast('正在提交...', '0', '5', '1');
    })

    function addComplaintCallBack(data) {
        appcan.window.closeToast();
        appcan.locStorage.remove('typeParam');
        if (data == "0") {
            uexWindow.evaluateScript("complaintAdd", 0, "closeCurPage()");
        } else {

        }
    }
</script>

</html>