<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">

<head>
    <title></title>
    <meta charset="utf-8">
    <meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link rel="stylesheet" href="../build/css/fonts/font-awesome.min.css">
    <link rel="stylesheet" href="../build/css/ui-box.css">
    <link rel="stylesheet" href="../build/css/ui-base.css">
    <link rel="stylesheet" href="../build/css/ui-color.css">
    <link rel="stylesheet" href="../build/css/appcan.icon.css">
    <link rel="stylesheet" href="../build/css/appcan.control.css">
    <link rel="stylesheet" href="css/infomgmt.css">
    <link rel="stylesheet" type="text/css" href="./css/branch.css" />
    <script src="../common/comm.js"></script>
    <style type="text/css">
        .bg-green {
            background-color: #78C44F;
        }

        /*绿色*/
    </style>
</head>

<body class="um-vp bc-bg" ontouchstart>
    <div class="ub ub-ver sc-bg">
        <!-- <div class="uinn-a6 t-gra3 ulev-app1">
                <div class="btn ub ub-ac bc-text-head ub-pc bg-green add"  id="lectCompany_btn">
                    新添加分公司
                </div>

            </div> -->
        <div id="companyList" class="ub ub-ver uinn-a1">

        </div>
    </div>

    <div class="wrapper pop-window hide">

        <div class="margin-a content">
            <form action="" id="myFormId" class="judge-form">

                <p class="margin-t-2x">
                    <span>请选择分公司：</span>

                    <i></i>
                    <select id="fgs" name="fgs" class="mySelect" style="font-size:1em;"></select>
                </p>

                <div class="action-group">
                    <button class="btn-submit my-btn" type="button" onclick="Choose()">
                        确定
                    </button>
                    <button class="margin-l-2x my-btn" type="button" onclick="cancel()">
                        取消
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script src="../build/js/appcan.js"></script>
    <script src="../build/js/appcan.control.js"></script>
    <script src="../common/template-web.js"></script>
    <script id="Company" type="text/html">
        {{each list}}
        <div class="ub-img-rank uinn-t-rank list-content">
            <div class="ub c-blu-rank uinn-a1 t-blu-rank umar-fr1">
                <div class="ub ub-pc ub-ac uw-rank2 center ut-s ulev-4 " value={{$value.orgId}}>
                    <p id="company_name" class="ellipsis">
                        {{$value.orgName}}
                    </p>


                </div>

                <span class="ub  ub-ac ub-pc s-state" style="font-size: 0.8em">
                    {{if $value.state == "0"}} 未审核 {{else if $value.state == "1"}} 已审核 {{else}} 审核未通过 {{/if}}
                </span>

                <div class="uw-rank center t-blu ulev-4 ufm1">
                    <div id={{$value.basOrgId}} class="btn ub ub-ac bc-text-head ub-pc bc-btn AllList" onclick="delMyCompany(id);">
                        解除绑定
                    </div>

                </div>

            </div>

        </div>

        {{/each}}

    </script>

    <script id="Toast" type="text/html">
        {{each list}}
        <option id={{$value.orgId}} onclick="" value={{$value.orgId}}>{{$value.orgName}}</option>

        {{/each}}

    </script>

</body>
<script>
    appcan.ready(function () {
        queryMyAddCompany();
        appcan.window.subscribe("GyfgsOK", function (refresh) {
            if (refresh == "0") {
                //window.location.reload();
                reload();
            }
        })
    });


    function reload() {
        $('#companyList').html = '';
        queryMyAddCompany();
    }

    function queryMyAddCompany() {
        var url = URL + "/app/cus/queryMyAddCompany";

        var paramJsonStr = "";
        var func = showCompanyCallback;
        var dataType = "text";
        ajaxPostQuery(url, paramJsonStr, func, dataType);
        appcan.window.openToast('正在加载...', '0', '5', '1');

    }

    function showCompanyCallback(data) {

        appcan.window.closeToast();

        if (typeof data == "string") {
            data = JSON.parse(data);
        };

        var html = template('Company', {
            list: data
        });

        $('#companyList').html(html);
        if (document.querySelector(".list-content:last-child")) {
            document.querySelector(".list-content:last-child").style.margin = "0  0 6em";
        }


        var FGS_list = [];

        data.forEach(function (v, i) {
            FGS_list.push(v.basOrgId);
        })

        appcan.locStorage.setVal("FGS_list", FGS_list);
    }

    //解除绑定
    function delMyCompany(id) {
        var url = URL + "/app/cus/delMyCompany";

        var paramJsonStr = "basOrgId=" + id;
        var func = delMyCompanyCallback;
        var dataType = "text";
        ajaxPostQuery(url, paramJsonStr, func, dataType);
        appcan.window.openToast('正在加载...', '0', '5', '1');
    }

    function delMyCompanyCallback(data) {
        appcan.window.closeToast();

        if (typeof data == "string") {
            data = eval("(" + data + ")");
        };
        if (data == "0") {
            reload();
            // uexWindow.evaluateScript("driverAdd", 0, "addDriverSuccess()");
        } else {
            appcan.window.alert({
                title: '提示',
                content: "解绑失败，请重试！",
                buttons: '确定'
            });
        }

    }
</script>

</html>