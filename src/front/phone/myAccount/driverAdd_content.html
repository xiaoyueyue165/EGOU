<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">

<head>
    <title></title>
    <meta charset="utf-8">
    <meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link rel="stylesheet" href="../build/css/fonts/font-awesome.min.css">
    <link rel="stylesheet" href="../build/css/ui-box.css">
    <link rel="stylesheet" href="../build/css/ui-base.css">
    <link rel="stylesheet" href="../build/css/ui-color.css">
    <link rel="stylesheet" href="../build/css/appcan.icon.css">
    <link rel="stylesheet" href="../build/css/appcan.control.css">
    <link rel="stylesheet" href="css/infomgmt.css">
    <script src="../common/comm.js"></script>
</head>

<body class="um-vp bc-bg" ontouchstart>
    <div class="user-info">
        <div class="ub ub-ver white-bg mf-size1 b-border" id="driverInfo">
        </div>
    </div>

    <div class="umar-a margin-t-l">
        <div class="btn ub ub-ac bc-text-head ub-pc bc-btn mp-btn" id="btn-save-driver">
            保&nbsp; &nbsp;存
        </div>
    </div>

    <script src="../build/js/appcan.js"></script>
    <script src="../build/js/appcan.control.js"></script>
</body>
<script>
    var driverId = "";
    var driverInfo = "";
    var ifModify = false;
    appcan.ready(function () {
        driverId = appcan.locStorage.getVal("driverId");
        driverInfo = appcan.locStorage.getVal("driverInfo");
        appcan.locStorage.remove("driverId");
        appcan.locStorage.remove("driverInfo");
        initDriverInfo();
    });

    function initDriverInfo() {
        var driverName = "";
        var driverCode = "";
        var driverOfficephone = "";
        var driverMobile = "";

        if (driverId == "" || driverId == null) {
            ifModify = false;
        } else {
            ifModify = true;
            if (typeof driverInfo == "string") {
                driverInfo = eval("(" + driverInfo + ")");
            }
            driverName = driverInfo.driverName;
            driverCode = driverInfo.driverCode;
            driverOfficephone = driverInfo.driverOfficephone;
            driverMobile = driverInfo.driverMobile;
        }

        var nameString =
            '<div class="ub m-row umar-l umar-r"><div class="ub ub-ac l-width"><span class="gray-font">司机姓名</span>' +
            '</div><div class="ub ub-ac ub-f1"><div class="uinput ub ub-f1">' +
            '<input placeholder="" type="text" class="ub-f1" value="' +
            driverName + '"></div></div></div>';
        var codeString =
            '<div class="ub m-row umar-l umar-r"><div class="ub ub-ac l-width"><span class = "gray-font">驾驶证号</span>' +
            '</div><div class="ub ub-ac ub-f1"><div class="uinput ub ub-f1">' +
            '<input placeholder="" type="text" class="ub-f1" value="' +
            driverCode + '"></div></div></div>';
        var phoneString =
            '<div class="ub m-row umar-l umar-r"><div class="ub ub-ac l-width"><span class="gray-font">联系电话</span>' +
            '</div><div class="ub ub-ac ub-f1"><div class="uinput ub ub-f1">' +
            '<input placeholder="" type="text" class="ub-f1" value="' +
            driverOfficephone + '"></div></div></div>';
        var mobileString =
            '<div class="ub m-row umar-l umar-r no-border-b"><div class="ub ub-ac l-width"><span class="gray-font">手机号码</span>' +
            '</div><div class="ub ub-ac ub-f1"><div class="uinput ub ub-f1">' +
            '<input placeholder="" type="text" class="ub-f1" value="' +
            driverMobile + '"></div></div></div>';
        $("#driverInfo").append(nameString + codeString + phoneString + mobileString);
    }

    appcan.button("#btn-save-driver", "btn-act", function () {
        driverName = $("input")[0].value;
        driverCode = $("input")[1].value;
        driverOfficephone = $("input")[2].value;
        driverMobile = $("input")[3].value;

        var codeReg = /^\d{15}$/;
        if (driverCode != "" && !codeReg.test(driverCode)) {
            uexWindow.alert("提示", "请输入有效的驾驶证号码，长度为15位!", "确定");
            return;
        }

        /*   var regexp = /^(0[0-9]{2,3}\-)?([2-9][0-9]{6,7})+(\-[0-9]{1,4})?$/;
          if (driverOfficephone != "" && !regexp.test(driverOfficephone)) {
              uexWindow.alert("提示", "请输入有效的联系电话!", "确定");
              return;
          } */

        var myreg = /^(((13[0-9]{1})|(15[0-9]{1})|(17[0-9]{1})|(18[0-9]{1}))+\d{8})$/;
        if (!myreg.test(driverMobile)) {
            uexWindow.alert("提示", "请输入有效的手机号码，长度为11位!", "确定");
            return;
        }

        var url = "";
        var paramJsonStr = "";
        if (ifModify) { //编辑
            url = URL + "/app/cus/driver/updateCusDriver";
            paramJsonStr = "driverId=" + driverId + "&driverName=" + driverName + "&driverCode=" + driverCode +
                "&driverOfficephone=" + driverOfficephone + "&driverMobile=" + driverMobile;
        } else { //新增
            url = URL + "/app/cus/driver/addCusDriver";
            paramJsonStr = "&driverName=" + driverName + "&driverCode=" + driverCode + "&driverOfficephone=" +
                driverOfficephone + "&driverMobile=" + driverMobile;
        }
        var func = updateCallback;
        var dataType = "text";
        ajaxPostQuery(url, paramJsonStr, func, dataType);
        appcan.window.openToast('正在提交数据...', '0', '5', '1');
    })

    function updateCallback(data) {
        appcan.window.closeToast();
        if (data == "0") {
            uexWindow.evaluateScript("driverAdd", 0, "addDriverSuccess()");
        } else {
            appcan.window.alert({
                title: '提示',
                content: "保存失败，请重试！",
                buttons: '确定'
            });
        }
    }
</script>

</html>