<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">

<head>
    <title></title>
    <meta charset="utf-8">
    <meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link rel="stylesheet" href="build/css/fonts/font-awesome.min.css">
    <link rel="stylesheet" href="build/css/ui-box.css">
    <link rel="stylesheet" href="build/css/ui-base.css">
    <link rel="stylesheet" href="build/css/ui-color.css">
    <link rel="stylesheet" href="build/css/appcan.icon.css">
    <link rel="stylesheet" href="build/css/appcan.control.css">
    <link rel="stylesheet" href="index/page3/index.css">
</head>

<body class="um-vp white-bg" ontouchstart>
    <div id="page_0" class="up ub ub-ver white-bg" tabindex="0">

        <!-- 登录模块 -->
        <div id="login" style="height:10em;background:url(./index/page3/myImg/head_bg.jpg);background-size:100%;">

            <div id="avatar" class="ub ub-ac ub-pc">
                <div id="photo" class="ub ub-ac ub-pc">

                </div>

                <div id="state">
                    <span id="refer" class="btn">立即登录</span>
                    <strong id="cusGrade"></strong>

                </div>

                <br />

            </div>

        </div>

        <!--content开始-->
        <div id="content" class="ub-f1 tx-l clearfix">

            <!--3个btn  -->
            <div id="list3" class="ub ub-ac ub-pc ubb bc-border ulev-1">

                <span id="list-1" class="font lineHeight ub ub-f1 ub-ac ub-pc" onclick="openDetailPage(id)"> 交易记录 </span>

                <i class="Line"></i>

                <span id="list-2" class="font lineHeight ub ub-f1 ub-ac ub-pc" onclick="openDetailPage(id)"> 我的订单 </span>
                <i class="Line"></i>

                <span id="list-3" class="font lineHeight ub ub-f1 ub-ac ub-pc" onclick="openDetailPage(id)"> 资金余额 </span>
            </div>
            <!--滚动油品  -->

            <div id="Oilcondition" class="uhide ub-f1">

                <h5 class="status lis ubb ub bc-border bc-text  ub-ac lis group">已购未提</h5>

                <ul id="slider1" class="ub ub-ac ub-pc ubb bc-border slider">

                </ul>

            </div>

            <div id="listview" class="sc-bg mf-size1"></div>

            <div class="top-gap"></div>

            <div class="ub ub-ac ub-pc m-row2 ubb bc-border white-bg" id="logout">
                退出登录
            </div>
            <div class="top-gap"></div>
        </div>
        <!--content结束-->

    </div>
</body>
<script src="build/js/appcan.js"></script>
<script src="build/js/appcan.control.js"></script>
<script src="build/js/appcan.listview.js"></script>
<script src="common/comm.js"></script>
<script type="text/javascript" charset="utf-8" src="common/numeral.min.js"></script>
<script>

    appcan.ready(function () {
        //去除滚动条
        uexWindow.setWindowScrollbarVisible('false');
        //禁用页面弹动效果
        appcan.window.disableBounce();

        // 初始化
        MyCount.init();

        // 检测登录状态
        appcan.window.subscribe("listPageRefresh", function (param) {
            if (param === "true") {
                console.log("listPageRefresh")
            }
        })

        // 公司用户
        appcan.window.subscribe("userForCompany", function (data) {
            if (data === '0') {
                console.log("userForCompany");
                MyCount.queryMyAccount();
            }

        });
        //退出登录
        appcan.window.subscribe("logout", function (param) {
            if (param == "logout") {
                $('#login').html('<div id="avatar" class="ub ub-ac ub-pc"><div id="photo" class="ub ub-ac ub-pc"></div><div id="state"><span id="refer" class="btn">立即登录</span><strong id="cusGrade"></strong></div><br /></div>');
                $('#Oilcondition').hide();
            }
            var photo = document.getElementById('photo'),
                refer = document.getElementById('refer');
            tap(photo, gotoLogin);
            tap(refer, gotoLogin);

        });

    });

    var MyCount = {
        init: function () {
            var y = this;
            y.queryMyAccount();
        },
        // 查询登录用户的基本信息
        queryMyAccount: function () {
            var username = appcan.locStorage.getVal("username");
            if (!username) {
                return;
            }

            var y = this,
                url = URL + "/app/cus/queryMyAccount",
                paramJsonStr = "",
                func = y.queryMyAccountCallback.bind(this),
                dataType = "text";

            ajaxPostQuery(url, paramJsonStr, func, dataType);
        },
        queryMyAccountCallback: function (data) {
            if (typeof data == "string") {
                data = JSON.parse(data)
                console.dir(data)
            }

            var cusCompany = data.cusCompany;
            appcan.locStorage.setVal("cusCompany", cusCompany);

            var cusGrade = data.cusGrade ? data.cusGrade : '普通客户';
            document.getElementById('cusGrade').className = "m-border1";
            document.getElementById('cusGrade').innerText = cusGrade;
            document.getElementById('photo').style.background = "url(./index/page3/myImg/avatar2.png)";
            document.getElementById('photo').style.backgroundSize = "100%";
            document.getElementById('refer').innerText = '欢迎您,' + cusCompany + '';
        },
        //查询已购未提油品
        queryCusOilReminder: function () {
            var y = this,
                url = URL + "/app/cus/queryCusOilReminder",
                paramJsonStr = "",
                func = y.queryCusOilReminderCallBack.bind(this),
                dataType = "text";
            ajaxPostQuery(url, paramJsonStr, func, dataType)
        },
        queryCusOilReminderCallBack: function (data) {
            if (typeof data == "string") {
                data = JSON.parse(data)
            }
        }

    }

    function gotoLogin() {
        var username = appcan.locStorage.getVal('username'),
            cusId = appcan.locStorage.getVal('cusId');
        if (username && cusId) {
            return;
        }
        appcan.locStorage.setVal("tag", "listpage");
        appcan.window.open("login", "userpage/login.html", 10);
    }


    //点击跳转登录
    appcan.button("#refer", "ani-act", function () {

        gotoLogin();
    })
    appcan.button("#photo", "ani-act", function () {

        gotoLogin();
    })

    appcan.button("#logout", "btn-act", function () {

        var username = appcan.locStorage.getVal("username");

        if (!username) {
            twoAlert("您还没有登录哦", "立即登录", "取消", function () {
                appcan.locStorage.setVal("tag", "listpage");
                appcan.window.open("login", "userpage/login.html", 10);
            })

            return;
        }
        var url = URL + "/comm/user/loginOut",
            paramJsonStr = "",
            func = logoutCallback,
            dataType = "text";
        ajaxPostQuery(url, paramJsonStr, func, dataType);
        appcan.window.openToast('正在退出...', '0', '5', '1');


    })
    function logoutCallback(data) {

        appcan.window.closeToast();

        if (data == "exit") {
            lsrmItems(["sid", "cusId", "password", "userId", "username", "userType", "tag", "QRCode"]);
            appcan.locStorage.setVal("status", "out");

            appcan.window.publish("logout", "logout");
            appcan.window.open("index", "index.html", 0);
        }
    }


    //三个button
    function openDetailPage(id) {
        var username = appcan.locStorage.getVal('username');
        var cusId = appcan.locStorage.getVal('cusId');
        if (!username || !cusId) {
            appcan.window.alert({
                title: "提示",
                content: "先登录再购油",
                buttons: ['立即登录', '取消'],
                callback: function (err, data, dataType, optId) {
                    if (data == '0') {
                        appcan.locStorage.setVal("tag", "listpage");
                        appcan.window.open("login", "userpage/login.html", 10);
                    }
                    if (data == '1') {

                    }
                    console.log(err, data, dataType, optId);
                }
            });
            return;
        } else {
            switch (id) {
                case 'list-1':
                    appcan.window.open("balance", "myAccount/funds/balance.html", 10);
                    break;
                case 'list-2':
                    appcan.window.open("intentionList", "buyOil/intentionList/intentionList.html", 10);
                    break;
                case 'list-3':
                    appcan.window.open("funds", "myAccount/funds/funds.html", 10);
                    break;
                default:
                    appcan.window.alert({
                        title: "提示",
                        content: "该功能模块暂时未开通,敬请期待",
                        buttons: ['我支持'],
                        callback: function (err, data, dataType, optId) {

                            console.log(err, data, dataType, optId);
                        }
                    });
            }
        }
    }

    var lv = appcan.listview({
        selector: "#listview",
        type: "thinLine",
        hasGroup: true,
        hasAngle: true,
        hasSubTitle: true
    });
    lv.set([{
        title: "账号管理",

        groupId: "A",
        items: [{
            title: "基本信息",
            icon: "build/css/list_icons/l_icon_info.png",
            id: 0,
            subTitle: '<div class="" style="color:#9c9c9c;font-size:1.1em">点击查看</div>',
        }, {
            title: "主账号信息",
            icon: "build/css/list_icons/l_icon_account.png",
            subTitle: '<div class="" style="color:#9c9c9c;font-size:1.1em">点击拨打</div>',
            id: 1
        }, {
            title: "分公司管理",
            icon: "build/css/list_icons/l_icon_site.png",
            subTitle: '<div class="" style="color:#9c9c9c;font-size:1.1em">查看管理</div>',
            id: 8

        }]
    }, {
        title: "资料管理",
        groupId: "B",
        items: [{
            title: "用油网点管理",
            icon: "build/css/list_icons/l_icon_site.png",
            subTitle: '<div class="" style="color:#9c9c9c;font-size:1.1em">查看管理</div>',
            id: 3
        }, {
            title: "提油车辆管理",
            icon: "build/css/list_icons/l_icon_truck.png",
            id: 4,
            subTitle: '<div class="" style="color:#9c9c9c;font-size:1.1em">查看管理</div>',
        }, {
            title: "司机信息管理",
            icon: "build/css/list_icons/l_icon_drivers.png",
            id: 5,
            subTitle: '<div class="" style="color:#9c9c9c;font-size:1.1em">查看管理</div>',
        }, {
            title: "押运员信息管理",
            icon: "build/css/list_icons/contact.svg",
            id: 9,
            subTitle: '<div class="" style="color:#9c9c9c;font-size:1.1em">查看管理</div>',
        }]
    }, {
        title: "账户安全",
        groupId: "C",
        items: [{
            title: "切换账户",
            icon: "build/css/list_icons/l_icon_exchange.png",
            subTitle: '<div class="" style="color:#9c9c9c;font-size:1.1em">点击切换</div>',
            id: 6
        }, {
            title: "修改密码",
            icon: "build/css/list_icons/l_icon_pwd.png",
            id: 7,
            subTitle: '<div class="" style="color:#9c9c9c;font-size:1.1em">点击修改</div>',
        }, {
            title: "我的客户经理",
            icon: "build/css/list_icons/l_icon_manager.png",
            id: 2,
            subTitle: '<div class="" style="color:#9c9c9c;font-size:1.1em">点击联系</div>'
        }, {
            title: "清理缓存",
            icon: "build/css/list_icons/finger-print.svg",
            id: 10,
            subTitle: '<div class="" style="color:#9c9c9c;font-size:1.1em">点击清理</div>'
        }, {
            title: "软件测试",
            icon: "build/css/list_icons/construct.svg",
            id: 77,
            subTitle: '<div class="" style="color:#9c9c9c;font-size:1.1em">点击清理</div>'
        }]
    }]);
    lv.on("click", function (ele, obj, curEle) {
        var username = appcan.locStorage.getVal('username');
        var cusId = appcan.locStorage.getVal('cusId');
        if (username && cusId) {
            switch (obj.id) {
                case 0:
                    appcan.window.open("basicInfo", "myAccount/basicInfo.html", 10);
                    break;
                case 1:
                    appcan.window.open("mainaccount", "myAccount/mainaccount.html", 10);
                    break;
                case 2:
                    appcan.window.open("contact", "myAccount/contact/contact.html", 10);
                    break;
                case 3:
                    appcan.window.open("siteMgmt", "myAccount/siteMgmt.html", 10);
                    break;
                case 4:
                    appcan.window.open("vehicleMgmt", "myAccount/vehicleMgmt.html", 10);
                    break;
                case 5:
                    appcan.window.open("driverMgmt", "myAccount/driverMgmt.html", 10);
                    break;
                case 6:
                    appcan.window.open("orglist", "userpage/chooseCompany.html", 10);
                    break;
                case 7:
                    appcan.window.open("passwordMgmt", "myAccount/passwordMgmt.html", 10);
                    break;
                //分公司管理
                case 8:
                    appcan.window.open("Branch", "myAccount/branch.html", 10);
                    break;
                //押运员管理
                case 9:
                    appcan.window.open("Branch", "myAccount/yayun.html", 10);
                    break;
            }
            // 已登录测试
            if (obj.id == 10) {
                appcan.window.open("Branch", "myAccount/appSet/news_set.html", 10);
            }
            if (obj.id == 77) {
                var username = appcan.locStorage.getVal('username');
                if (username == "gerenceshi1") {
                    // 软件测试
                    appcan.window.open("Branch", "test/test.html", 10);
                } else {
                    oneAlert("仅测试人员登录后可用", "确定")
                }

            }

            // 未登录清理缓存
        } else if (obj.id == 10) {
            appcan.window.open("Branch", "myAccount/appSet/news_set.html", 10);
            // 未登录测试
        } else if (obj.id == 77) {

            oneAlert("仅测试人员登录后可用", "确定")

        }
        else {

            twoAlert("先登录再购油", "立即登录", "取消", function () {
                appcan.locStorage.setVal("tag", "listpage");
                appcan.window.open("login", "userpage/login.html", 10);
            })

            return;

        }
    })

</script>

</html>