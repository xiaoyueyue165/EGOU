<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link rel="stylesheet" href="../build/css/fonts/font-awesome.min.css">
    <link rel="stylesheet" href="../build/css/ui-box.css">
    <link rel="stylesheet" href="../build/css/ui-base.css">
    <link rel="stylesheet" href="../build/css/ui-color.css">
    <link rel="stylesheet" href="../build/css/appcan.icon.css">
    <link rel="stylesheet" href="../build/css/appcan.control.css">
    <title></title>
    <style type="text/css">
        .box {
            height: 6em;
            text-align: center;
            vertical-align: center;
            position: relative;
        }

        .box button {
            position: absolute;
            top: 1.8em;
        }
    </style>
</head>

<body class="um-vp white-bg" ontouchstart>
    <div id="page_0" class="up ub ub-ver white-bg" tabindex="0">
        <div id="content">

            <h2>检查更新</h2>
            <div class="box ub">
                <button class="btn" onclick="checkUpdate()">
                    检查更新
                </button>
            </div>

            <hr>
            <h2>获取当前app的版本号</h2>
            <div class="box ub">
                <button class="btn" onclick="getAppVersion()">
                    获取app的版本
                </button>
            </div>
            <hr>
            <h2>本地下载</h2>
            <div class="box ub">
                <button class="btn" onclick="localDownLoad()">
                    本地下载
                </button>
            </div>

        </div>
    </div>
</body>

<script src="../build/js/appcan.js"></script>
<script src="../build/js/appcan.control.js"></script>
<script src="../common/template-web.js" type="text/javascript" charset="utf-8"></script>
<script src="../common/comm.js"></script>
<script src="../common/es6-shim.js"></script>

<script>
    appcan.ready(function () {
        //首页调用函数：

        setBounce([0, 1], '', function (type) {
            // getAllData("1");
        }, '#fff');

        oneAlert("提示", "123", function () {
            alert("callback")
        })

        //函数定义
        function setBounce(bounceType, startPullCall, downEndCall, upEndCall, color, imgSettings) { //设置一个函数，对产品页面进行相关事件响应

            var argObj = null;
            color = color || 'rgba(255,255,255,0)';
            //默认主窗口背景颜色设置
            var time = new Date();
            //var time =M.date.format(new Date(),'yyyy-MM-dd hh:mm:ss');
            //alert("time=-=====" + time)
            var upImgSettings = {
                "textColor": "#530606",
                "imagePath": "",
                "levelText": "上次更新时间:" + time,
                "pullToReloadText": "下拉刷新",
                "releaseToReloadText": "释放立即刷新",
                "loadingText": "正在刷新…"
            };
            var downImgSettings = {
                "textColor": "#530606",
                "imagePath": "res://reload.png",
                "pullToReloadText": "加载更多",
                "releaseToReloadText": "释放立即刷新",
                "loadingText": "加载中…"
            };
            var startBounce = 1;
            //绑定回弹通知函数
            uexWindow.onBounceStateChange = function (type, status) {
                if (status == 0) {
                    startPullCall && startPullCall(type);
                    try { //将产品页面的弹出层隐藏
                        uescript('fundProduct', 'toggleChoose(true)');
                    } catch (e) {}
                }
                if (status == 1 && type == 0) { //顶部下拉到顶回调
                    downEndCall && downEndCall(type);
                    alert("下拉刷新开始被调用");
                }
                if (status == 2 && type == 1) { //底部上拉到底回调
                    upEndCall && upEndCall(type);
                    alert("上拉刷新开始被调用");

                }
            };
            uexWindow.setBounce(startBounce);
            //绑定下拉回调
            if (startPullCall || downEndCall || upEndCall) {
                // if(!appcan.isArray(bounceType)){
                // bounceType=[bounceType];
                // }
                for (var i = 0; i < bounceType.length; i++) {
                    if (bounceType[i] == 0) {
                        uexWindow.setBounceParams(0, upImgSettings);
                    } else {
                        uexWindow.setBounceParams(1, downImgSettings)
                    }
                    uexWindow.showBounceView(bounceType[i], color, '1');
                    uexWindow.notifyBounceEvent(bounceType[i], '1');
                }



            }
        }

        var btnArr = Array.from(document.querySelectorAll("button"));
        console.log(btnArr)

        function addTip(type, msg) {
            setTimeout(function () {
                appcan.window.resetBounceView(type);
                if (type == 0) {
                    var time = M.date.format(new Date(), 'yyyy-MM-dd hh:mm:ss');
                    var json = {
                        "textColor": "#530606",
                        "imagePath": "res://reload.png",
                        "levelText": "上次更新时间:" + time,
                        "pullToReloadText": "下拉刷新",
                        "releaseToReloadText": "释放立即刷新",
                        "loadingText": "正在刷新…"
                    };
                    uexWindow.setBounceParams(0, json);
                }
                if (msg) {
                    uexWindow.toast(0, 5, msg, '1000');
                }
            }, 1500);
        }

        var value = uexWidgetOne.platformName;

    })

    function checkUpdate() {
        uexWidget.checkUpdate(function (error, data) {
            if (!error) {
                alert(JSON.stringify(data))
                var AAAAAA = data.result;
                alert('data.result' + AAAAAA);
            }
        });

        uexWidget.cbCheckUpdate = function (opId, dataType, data) {
            alert('opid:' + opId + ',dataType:' + dataType + ',data:' + data);
        }
    }


    function getAppVersion() {

        uexWidgetOne.getCurrentWidgetInfo();
        uexWidgetOne.cbGetCurrentWidgetInfo = function (opId, dataType, data) {
            var info = JSON.parse(data);
            alert(JSON.stringify(info))
            var softVer = info.version;
            alert('版本号为' + softVer)
        }
    }

    function localDownLoad() {
        var db_url = "http://wallpaper.pocketdigi.com/upload/1/bigImage/1284565196.jpg";
        var down_path = "res://app.apk";
        var downloader = uexDownloaderMgr.create();
        var down_logings =
            '<div class="updata_apk" id="updata_apk"><div class="uv tx-c uinn-p2">正在下载</div><div class="clear1"></div><div class="ub m-l-r2" id="logding"><span id="logdings"></span></div></div>'
        $('body').after(down_logings);
        uexDownloaderMgr.download(downloader, db_url, down_path, 1, function (fileSize, percent, status) {
            switch (status) {
                case 0:
                    $("#logdings").css('width', percent + "%");
                    return;
                    break;
                case 1:
                    $("#updata_apk").addClass('uhide')
                    uexDownloaderMgr.closeDownloader(downloader)
                    setTimeout(function () {
                        uexWidgetOne.exit(0)
                    }, 100);
                    uexWidget.installApp(down_path);

                    break;
                case 2:
                    uexDownloaderMgr.closeDownloader(downloader)
                    break;
            }
        });

    }
</script>

</html>