<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">
    <head>
        <title></title>
        <meta charset="utf-8">
        <meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <link rel="stylesheet" href="../../build/css/fonts/font-awesome.min.css">
        <link rel="stylesheet" href="../../build/css/ui-box.css">
        <link rel="stylesheet" href="../../build/css/ui-base.css">
        <link rel="stylesheet" href="../../build/css/ui-color.css">
        <link rel="stylesheet" href="../../build/css/appcan.icon.css">
        <link rel="stylesheet" href="../../build/css/appcan.control.css">
        <link rel="stylesheet" href="../oil_content/css/oil_detail_content.css">
        <script type="text/javascript" src="../../common/comm.js"></script>
    </head>
    <body class="um-vp sc-bg-active" ontouchstart>
        
        <div class="sc-bg" id="oilInfo"></div>
        <div class="sc-bg" id="cuxiao"></div>
        <div class="sc-bg" id="fuyoufangshi"></div>
        <div id="jihuo"></div>
        <div id="denglu"></div>
        <div id="zhuce"></div>
        
        <script src="../../build/js/appcan.js"></script>
        <script src="../../build/js/appcan.control.js"></script>

    </body>
    <script>
        var zhuanshu = 0;
        var savePrice = 0;
        var fangshi = 0;
        var lijisumprice = 0;
        var pickupDiscount =0;
        var zhuanshu_show;
        appcan.ready(function() {
            //queryPickupDiscount();
            var oildata = appcan.locStorage.getVal("initDetailData");
            appcan.locStorage.setVal("oilNum", 1);
            showOilDetailData(oildata);
        })
        
        function queryPickupDiscount(){
            
            var url = URL + "/cacheable/getPickupDiscountCacheable";//访问路径
            var paramJsonStr = "id=pickup_cache";//参数
            var func = showPickupDiscount;//返回的方法
            var dataType = "text";
            ajaxPostQuery(url, paramJsonStr, func, dataType);
        }
        
        function showPickupDiscount(data){
            
            if ( typeof data == "string") {
                data = eval("(" + data + ")");
            }
            pickupDiscount = data.pickupDiscount;
            
            $("#pickup").html("提示：*自提可在配送价格基础上优惠"+pickupDiscount+"元/吨。");
        }
        
        function showOilDetailData(data) {

            if ( typeof data == "string") {
                data = eval("(" + data + ")");
            }
            var cusState = data.cusState;//客户状态
            var cusId = data.cusId;//客户ID
            var oilinfoId = data.oilinfoId;//油品ID
            var oilinfoName = data.oilinfoName;//油品名称
            var providePrice = data.providePrice;//国家定价
            var marketPrice = data.marketPrice;//挂牌价
            zhuanshu = data.zhuanshu;//专属价
            var oilIntroduct = data.oilIntroduct;//油品介绍
            pickupDiscount = data.pickupDiscount;
            if ( typeof (pickupDiscount) == "undefined") {
                pickupDiscount = 0;
            }
            var tips = "提示：*自提可在配送价格基础上优惠"+pickupDiscount+"元/吨。";


            if ( typeof (providePrice) == "undefined") {
                providePrice = "暂无定价";
            }
            if ( typeof (marketPrice) == "undefined") {
                marketPrice = "暂无定价";
            }
            if ( typeof (zhuanshu) == "undefined" ||zhuanshu==0) {
                zhuanshu_show = "暂无定价";
            }
            savePrice = zhuanshu;
            appcan.locStorage.setVal("savePrice", savePrice);
                
            if ( typeof (oilIntroduct) == "undefined") {
                oilIntroduct = "";
            }
            
            if(marketPrice!="暂无定价"){
                marketPrice="￥"+marketPrice+"/吨";
            }
            
            if(zhuanshu_show!="暂无定价"){
                zhuanshu_show='<span id="price" class="mf-color">￥'+zhuanshu+'</span><span class="mf-size2 gray-font">/吨</span>';
            }

            if (cusState == "1") {//激活用户
                var oilInfoHtml = '<div class="ub ub-ac umar-l umar-r m-row" id="">'
                                +oilinfoName 
                                +'</div><div class="ub ub-ac m-row4" id="">'
                                +'<div id="" class="umar-r"><span class="mf-size1 gray-font">专属价格 </span>'
                                +zhuanshu_show 
                                +'</div><div id="" class="umar-l"><span class="gray-font mf-size2">挂牌价<span class="ptxt">'
                                +marketPrice 
                                +'</span></span>'
                                +'</div></div>';
                
                $("#oilInfo").append(oilInfoHtml);
                
                var fyfangshiHtml = '<div class="ub m-row5 b-border umar-l umar-r" id="">'
                                +'<div id="" class="width1  mf-size1">'
                                +'<span class="m-lineheight gray-font">付油方式</span></div>'
                                +'<div class="ub ub-ver width2" id="">'
                                +'<div class="switch-wrapper m-switch" onclick="fyTypeChanged()">'
                                +'<span id="peisong" class="s-item focus l-radius">配送</span><span id="ziti" class="s-item nofocus r-radius">自提</span>'
                                +'</div><div id="" class="margin-t">'
                                +'<span class="gray-font mf-size2" id="pickup">'+tips+'</span>'
                                +'</div></div></div>'
                                +'<div class="ub ub-ac mf-size1 b-border m-row4" id="">'
                                +'<div id="" class="width1 umar-l">'
                                +'<span class="m-lineheight gray-font">购油数量</span>'
                                +'</div><div id="" class="">'
                                +'<input class="m-input mf-size1" type="" name="" id="count" value="1" oninput="priceChange()" onpropertychange="priceChange()" /><span class="umar-l mf-size2 gray-font">吨</span>'
                                +'</div></div>';
                                
                $("#fuyoufangshi").append(fyfangshiHtml);
                $("#fuyoufangshi").before('<div class="gap"></div>');
                
            }else{
                
                var oilInfoHtml = '<div class="ub ub-ac umar-l umar-r m-row" id="">'
                +oilinfoName 
                +'</div><div class="ub ub-ac m-row4" id="">'
                +'<div id="" class="umar-r"><span class="mf-size1 gray-font">挂牌价 </span><span class="mf-color">￥'
                +marketPrice 
                +'</span><span class="mf-size2 gray-font">/吨</span>'
                +'</div><div id="" class="umar-l"><span class="gray-font mf-size2">国家定价<span class="ptxt">￥'
                +providePrice 
                +'/吨</span></span>'
                +'</div></div>';
                
                $("#oilInfo").append(oilInfoHtml);

                if(cusId == ""){//未登录
                    var dengluHtml ='<div class="umar-l margin-t">'
                                   +'<span class="mf-size2 gray-font">会员登录查看专属价格</span>'
                                   +'<span class="umar-l inline-block mf-size2 m-act2" onclick="toLogin()">立即登录</span>'
                                   +'</div>';
                    $("#denglu").append(dengluHtml);
                    
                    var zhuceHtml = '<div class="umar-l margin-t">'
                                   +'<span class="mf-size2 gray-font">还没有成为会员？</span>'
                                   +'<span class="umar-l inline-block mf-size2 m-act2 r-bg" onclick="toRegister()">立即注册</span>'
                                   +'</div>'
                    $("#zhuce").append(zhuceHtml);
                }else{//未激活
                    var jihuoHtml = '<div class="umar-l margin-t">'
                                    +'<span class="mf-size2 gray-font m-lineheight">您的账号尚未激活，我们会尽快处理，请您耐心等待或联系我们!</span>'
                                    +'<span class="umar-l inline-block mf-size2 m-act2">联系客户经理</span>'
                                    +'</div>' 
                    $("#jihuo").append(jihuoHtml);
                }
            }
            
            // var cuxiaoHtml = '<div class="ub mf-size1 m-row4" id=""><div id="" class="width1">'
                    // +'<span class="m-lineheight gray-font">促销信息</span>'
                // +'</div><div id="" class="umar-l umar-r width2">'
                    // +'<span class="tag-price umar-r">满减</span><span class="m-lineheight" >2015年12月1日-2015年12月5月期间，购买本油品超过100吨，可享受每吨优惠20元优惠</span>'
                // +'</div></div>';
                // $("#cuxiao").append(cuxiaoHtml);
                // $("#cuxiao").before('<div class="gap"></div>');
        }
        
        var peisong = true;
        function fyTypeChanged(){
            if(peisong){
                $("#peisong")[0].className = "s-item nofocus l-radius";
                $("#ziti")[0].className = "s-item focus r-radius";
                peisong = false;
                fangshi = 1;
                savePrice = Number(zhuanshu) - pickupDiscount;
            }else{
                $("#peisong")[0].className = "s-item focus l-radius";
                $("#ziti")[0].className = "s-item nofocus r-radius";
                peisong = true;
                fangshi = 0;
                savePrice = zhuanshu;
            }
            $("#price")[0].innerHTML = "￥"+savePrice;
            appcan.locStorage.setVal("extractType", fangshi);
            appcan.locStorage.setVal("savePrice", savePrice);
        }
        
        //修改价格
        function priceChange(){
             var num=document.getElementById("count").value;
             appcan.locStorage.setVal("oilNum", num);
        }
        
        //未登录用户，去登录
        function toLogin(){
            appcan.locStorage.setVal("tag", "listpage");
            appcan.window.open("toLogin", "../index2.html", 10);
        }
        
        function toRegister(){
            appcan.window.open("toRegister", "../userpage/register.html", 10);
        }

    </script>
</html>