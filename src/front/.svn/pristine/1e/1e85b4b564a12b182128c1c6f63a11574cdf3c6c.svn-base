<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">

<head>
    <title></title>
    <meta charset="utf-8">
    <meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link rel="stylesheet" href="../../build/css/fonts/font-awesome.min.css">
    <link rel="stylesheet" href="../../build/css/ui-box.css">
    <link rel="stylesheet" href="../../build/css/ui-base.css">
    <link rel="stylesheet" href="../../build/css/ui-color.css">
    <link rel="stylesheet" href="../../build/css/appcan.icon.css">
    <link rel="stylesheet" href="../../build/css/appcan.control.css">
    <link rel="stylesheet" href="css/intentionList.css">
    <style type="text/css">
        ::-webkit-scrollbar {
            width: 0px;
        }

        ::-webkit-scrollbar {
            display: none;
            /*隐藏滚轮*/
        }
    </style>
</head>

<body class="um-vp bc-bg" ontouchstart>
    <div class="tx-c sc-bg-active" id="pullstatus0"></div>
    <div id="" class="listbox">
        <div id="listdetail" class="detail bc-border"></div>
        <div id="more"></div>
    </div>
    <!-- 拉的更新状态 -->
    <div class="tx-c" id="pullstatus1"></div>

    <script src="../../build/js/appcan.js"></script>
    <script src="../../build/js/appcan.control.js"></script>
    <script src="../../common/comm.js"></script>
    <script type="text/javascript" charset="utf-8" src="../../common/template-web.js"></script>
</body>

<script id="test" type="text/html">

        {{each list}}
        <div id='list" + i + "' class='list-content white-bg'><div id='orderlist" + i + "'>

        <div id='' class='ub ub-ac umar-a m-row3'><span class='gray-font'>付邮通知单号&nbsp;&nbsp;</span><span>
        {{$value.noticeCode}}
        </span></div>
        <div id='' class='ub ub-ac umar-a m-row3'><div id='' class='ub ub-ac t-col1'>
        <!-- 油品名称 -->

        {{$value.oilinfoName}}

        </div><div id='' class='ub ub-ac ub-pc t-col2'><span class='umar-r mf-color umar-r'><span class='mf-size2'></span>
        <!-- 油品价格 -->

        {{$value.deportName}}

        <!-- 油品数量-->

        </span></div><div id='type' class='ub ub-ac  ub-pc t-col4'><span class='s-state delivery'>
        <!-- 配送方式 -->

        {{if $value.extractType=='0'}}
        配送                {{else if $value.extractType == '1'}}
        自提
        {{/if}}

        </span></div></div>
        <div id='pay' class='ub ub-ac umar-l umar-r m-row3'><div id='' class='col-left'><span class='gray-font'>数量&nbsp;&nbsp;</span><span>
        {{$value.oilNumber}}
        <span class='gray-font mf-size2'>/吨</span>
        </span></div><div id='total' class='col-right'><span class='gray-font'>总价&nbsp;&nbsp; <span style="color:#000">
        ￥{{$value.oilAmot | changeMoney}}
        <span class='gray-font mf-size2'>/元</span></span><span class='mf-color AllPrice'>

        </span></div></div>


        <!-- 所属公司 -->
        <div id='' class='ub ub-ac umar-l umar-r m-row3'><div id='' class=''><span class='gray-font'>销售单位&nbsp;&nbsp;</span><span>
        {{$value.gyfgs}}

        </span></div></div>

        </div></div>
        <div class='gap'></div>
        {{/each}}
    </script>
<script>
    template.defaults.imports.changeMoney = function (value) {
        return fmoney(value)
    }
    var totalNum = 0;
    appcan.ready(function () {
        uexWindow.setWindowScrollbarVisible('false');
        appcan.frame.setBounce([0, 1], function (type) {
            $("#pullstatus" + type).html("");
        }, function (type) {
            $("#pullstatus" + type).html("");
        }, function (type) {
            appcan.frame.resetBounce(type);
            if (type == 0) {
                offset = 1;
            } else {
                offset = Number(offset) * limit + 1;
                if (Number(totalNum) < offset) {
                    $("#pullstatus" + type).html("");
                    appcan.window.openToast({
                        msg: '无更多信息',
                        duration: 1000,
                        position: 5,
                        type: 0
                    });
                    return;
                }
            }

            getOrderToFY(type);
        })
        appcan.window.subscribe("MEF", function (param) {
            if (param == "manager") {
                //window.location.reload();
                reload();
                appcan.window.open("viewEvaluate", "../ordermgmt/viewEvaluate.html", 10);
            }
        });
        getOrderToFY();
    });

    function reload() {
        $("#listdetail").html("");
        getOrderToFY();
    }

    function getOrderToFY(newPageNO) {
        var pageNo = newPageNO || 1;
        var url = URL + "/app/bill/getAllNotice";
        var paramJsonStr = "pageSize=" + limit + "&pageNo=" + pageNo;
        var func = getOrderToFYCallBack;
        var dataType = "text";
        ajaxPostQuery(url, paramJsonStr, func, dataType);
        appcan.window.openToast('数据加载中...', '0', '5', '1');
    }

    function getOrderToFYCallBack(data) {
        appcan.window.closeToast();
        if (typeof data == "string") {
            var data = JSON.parse(data);
        }


        var orderList = data.list;

        if (orderList.length == 0) {
            nodata('listdetail', '您没有符合条件的付油通知单')
            return;
        } else {
            var html = template('test', {
                list: data.list
            })

            $('#listdetail').append(html);

            loadMore.init({
                ele: "more",
                data: orderList,
                totalNum: data.totalRows,
                limit: 15,
                clickFn: func2
            });
        }

    }

    function func2(current_page, max_page, totalNum) {
        console.log(arguments)
        var y = this;
        console.log(this);
        $('#loadMore').remove();
        alert("正在加载第" + current_page + "页， 共" + max_page + "页 " + totalNum + "条数据")
        var y = this;
        getOrderToFY(current_page);
        appcan.window.openToast('数据加载中...', '0', '5', '1');
    }

    //评价客户经理
    function managerEvaluate(billNo) {
        appcan.locStorage.setVal("managerEvaluate_orderId", billNo);
        appcan.window.open("managerEvaluate", "../ordermgmt/managerEvaluate.html", 10);
    }

    //查看评价
    function viewEvaluate(billId) {
        appcan.locStorage.setVal("viewmanagerEvaluate_orderId", billId);
        appcan.window.open("viewEvaluate", "../ordermgmt/viewEvaluate.html", 10);
    }
</script>

</html>