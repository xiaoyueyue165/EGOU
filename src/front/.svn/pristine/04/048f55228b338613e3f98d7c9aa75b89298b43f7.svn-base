<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">

<head>
    <title></title>
    <meta charset="utf-8">
    <meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link rel="stylesheet" href="../../build/css/fonts/font-awesome.min.css">
    <link rel="stylesheet" href="../../build/css/ui-box.css">
    <link rel="stylesheet" href="../../build/css/ui-base.css">
    <link rel="stylesheet" href="../../build/css/ui-color.css">
    <link rel="stylesheet" href="../../build/css/appcan.icon.css">
    <link rel="stylesheet" href="../../build/css/appcan.control.css">
    <link rel="stylesheet" href="css/complaint.css">
</head>

<body class="um-vp white-bg" ontouchstart>
    <div class="ub ub-ver" id="cadata"></div>
    <div id="envaluate" class="uhide">
        <div class="title-bar gray-font padding-a1 t-border">
            <span class="umar-l mf-size2">处理结果评价</span>
        </div>
        <div class="">
            <div id="" class="ub ub-ac ub-pc m-row2 umar-t">
                <span id=1 class="state selected" onclick="levelChoose(id)">满意</span>
                <span id=2 class="state umar-l" onclick="levelChoose(id)">一般</span>
                <span id=3 class="state umar-l" onclick="levelChoose(id)">不满意</span>
            </div>
            <div class="umar-a margin-t-l">
                <div class="btn ub ub-ac bc-text-head ub-pc bc-btn mp-btn" id="btn-save-evaluate">
                    提&nbsp; &nbsp;交
                </div>
            </div>
        </div>
    </div>
    <div id="evacon" class="uhide">
        <div class="title-bar gray-font padding-a1 t-border">
            <span class="umar-l mf-size2">处理结果评价</span>
        </div>
        <div class="">
            <div id="" class="ub ub-ac ub-pc m-row2 umar-t">
                <span>您的评价结果是：</span>
                <span id=4 class="state selected"></span>
            </div>
        </div>
    </div>

    <script src="../../build/js/appcan.js"></script>
    <script src="../../build/js/appcan.control.js"></script>
    <script src="../../common/comm.js"></script>
</body>
<script>
    var evalued = false;
    var caid = "";
    appcan.ready(function () {
        var caData = appcan.locStorage.getVal("caparam");
        var catitle = caData.split("&")[0];
        caid = caData.split("&")[1];
        if (caData.split("&")[2] != "undefined") {
            $("#evacon").removeClass("uhide");
            var evaValue = "满意";
            if (caData.split("&")[2] == 1) {
                evaValue = "满意";
            } else if (caData.split("&")[2] == 2) {
                evaValue = "一般";
            } else if (caData.split("&")[2] == 3) {
                evaValue = "不满意";
            }
            $("#4")[0].innerHTML = evaValue;
            evalued = true;
        }
        queryComplanit(catitle, caid);
    });

    function queryComplanit(title, id) {
        var url = URL + "/app/complanit/queryComplanitAdvice";
        var paramJsonStr = "caId=" + id + "&caTitle=" + title + "&pager.pageNo=" + offset + "&pager.pageSize=" + limit;
        var func = queryComplaintCallBack;
        var dataType = "text";
        ajaxPostQuery(url, paramJsonStr, func, dataType);
        appcan.window.openToast('加载中...', '0', '5', '1');
    }

    function queryComplaintCallBack(data) {
        appcan.window.closeToast();
        data = eval("(" + data + ")");

        var caData = data.rows[0];

        var caType = "";
        if (caData.caType == "0") {
            caType = "投诉";
        } else if (caData.caType == "1") {
            caType = "建议";
        }

        var companyCont = caData.companyCont;
        if (typeof (companyCont) == "undefined") {
            companyCont = "";
        }
        var salerCont = caData.salerCont;
        if (typeof (salerCont) == "undefined") {
            salerCont = "";
        }

        var htmlStr =
            '<div class="title-bar gray-font padding-a1 mf-size2"><span class="umar-l">客户投诉内容</span></div><div class="ub m-row4 ub-ac mf-size1"><div><span>【' +
            caType + '】</span><span>' +
            caData.caTitle +
            '</span></div></div><div class="ub margin-l margin-r padding-b-2x gray-font mf-size2 b-dotted-border mf-size1 umar-t"><span class="margin-r">内容类型：' +
            caData.caContTypeName + '</span><span>' +
            caData.createDate +
            '</span></div>' +
            '<div class="ub m-row4 umar-l umar-r">' +
            caData.caContent + '</div>' +
            '<div class="title-bar gray-font padding-a1 t-border mf-size2"><span class="umar-l">客户经理处理</span></div>' +
            '<div class="ub m-row1 umar-l umar-r mf-size1"><div class="ub ub-ac l-width2"><span class="gray-font">分公司回复</span></div> <div class="ub ub-ac ub-f1">' +
            companyCont + '</div></div>' +
            '<div class="ub m-row2 umar-l umar-r mf-size1"><div class="ub ub-ac l-width2"><span class="gray-font">客户经理回复</span></div> <div class="ub ub-ac ub-f1">' +
            salerCont + '</div></div>';

        $("#cadata").append(htmlStr);

        if (caData.caState == "2") {
            if (evalued == false) {
                $("#envaluate").removeClass("uhide");
            }
        }
    }

    var evaluateTag = 0;

    function levelChoose(id) {
        $("#" + id).addClass("selected");
        $('#envaluate span').not($("#" + id)).removeClass('selected');
        evaluateTag = id;
    }

    appcan.button("#btn-save-evaluate", "btn-act", function () {
        var url = URL + "/app/complanit/updateComplanitAdvice";
        var paramJsonStr = "caId=" + caid + "&cusEvalue=" + evaluateTag;
        var func = updateComplanitAdviceCallBack;
        var dataType = "text";
        ajaxPostQuery(url, paramJsonStr, func, dataType);
        appcan.window.openToast('正在提交评价...', '0', '5', '1');
    })

    function updateComplanitAdviceCallBack(data) {
        appcan.window.closeToast();
        if (data == "0") {
            uexWindow.evaluateScript("complaintDetail", 0, "closePage()");
        } else {
            uexWindow.alert("评价提交失败");
        }
    }
</script>

</html>