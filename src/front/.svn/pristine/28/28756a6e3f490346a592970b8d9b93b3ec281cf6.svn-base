<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">
    <head>
        <title></title>
        <meta charset="utf-8">
        <meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <link rel="stylesheet" href="../build/css/fonts/font-awesome.min.css">
        <link rel="stylesheet" href="../build/css/ui-box.css">
        <link rel="stylesheet" href="../build/css/ui-base.css">
        <link rel="stylesheet" href="../build/css/ui-color.css">
        <link rel="stylesheet" href="../build/css/appcan.icon.css">
        <link rel="stylesheet" href="../build/css/appcan.control.css">
        <link rel="stylesheet" href="css/intentionList.css">
        <link rel="stylesheet" type="text/css" href="./css/search.css"/>
    </head>
    <body class="um-vp bc-bg" ontouchstart onload="checkedAll();">
        <!--header开始-->
        <div id="header" class="fix uh bc-text-head ub bc-head">
            <div class="nav-btn" id="nav-left">
                <div class="t-btn-a1 ub-img uwh-tBtn fa fa-angle-left fa-2x"></div>
            </div>
            <h1 class="ut ub-f1 ulev-3 ut-s tx-c" tabindex="0">销售结算单号查询</h1>
            <div class="nav-btn nav-bt" id="nav-right"></div>
        </div>
        <div id="header1" class="uh bc-text-head ub bc-head">
            <div class="nav-btn" id="nav-left">
                <div class="t-btn-a1 ub-img uwh-tBtn fa fa-angle-left fa-2x"></div>
            </div>
            <h1 class="ut ub-f1 ulev-3 ut-s tx-c" tabindex="0">隐藏</h1>
            <div class="nav-btn nav-bt" id="nav-right"></div>
        </div>
        <div class="tx-c sc-bg-active" id="pullstatus0"></div>
        <div id="" class="listbox">
            <div id="listdetail" class="detail white-bg bc-border" >

            </div>
        </div>
        <div class="tx-c" id="pullstatus1"></div>

        <script src="../build/js/appcan.js"></script>
        <script src="../build/js/appcan.control.js"></script>
        <script type="text/javascript" src="../common/comm.js"></script>
        <script src="../common/numeral.min.js"></script>
        <script type="text/javascript" charset="utf-8" src="../common/template-web.js"></script>
        <script type="text/javascript" charset="utf-8" src="../common/jquery.min.js"></script>

        <script id="test" type="text/html">

            {{each list}}
            <div id='list" + i + "' class='list-content white-bg'><div id='orderlist" + i + "'>

            <div id='' class='ub ub-ac umar-a m-row3'><span class='gray-font'>销售结算单号&nbsp;&nbsp;</span><span>
            {{$value.erpStatementCode}}
            </span></div>
            <div id='' class='ub ub-ac umar-a m-row3'><div id='' class='ub ub-ac t-col1'>
            <!-- 油品名称 -->

            {{$value.oilinfoName}}

            </div><div id='' class='ub ub-ac ub-pc t-col2'><span class='umar-r mf-color umar-r'><span class='mf-size2'>￥</span>
            <!-- 油品价格 -->

            {{$value.oilPrice|Fmoney}}

            <span class='gray-font mf-size2'>/吨</span></span><span class='umar-l'>
            <!-- 油品数量-->

            x {{$value.oilNumber}}

            </span></div><div id='type' class='ub ub-ac  ub-pc t-col4'><span class='s-state delivery'>
            <!-- 配送方式 -->

            {{$value.extractTypeName}}

            </span></div></div>
            <div id='pay' class='ub ub-ac umar-l umar-r m-row3'><div id='' class='col-left'><span class='gray-font'>运输方式&nbsp;&nbsp;</span><span>
            {{if $value.extractType=='0'}}
            公路                    {{else if $value.extractType == '1'}}
            水路
            {{/if}}
            </span></div><div id='total' class='col-right'><span class='gray-font'>合计&nbsp;&nbsp; {{$value.oilAmot|Fmoney}}</span><span class='mf-color AllPrice'>

            </span></div></div>

            <!-- 油库地点，销售单位-->
            <div id='company' class='ub ub-ac umar-l umar-r m-row3'><div id='' class='col-left'><span class='gray-font'>油库地点&nbsp;&nbsp;</span><span id="ykdd" value={{$index}}>
            {{$value.ykdd | getYkdd}}
            </span></div><div id='total' class='col-right'><span class='gray-font'>销售单位</span><span class="fgs" id="gyfgs" code ={{$value.gyfgs}}>
            {{$value.gyfgs | getFgs}}
            </span><span class='mf-color AllPrice'>

            </span></div></div>

            </div></div>
            <div class='gap'></div>
            {{/each}}
        </script>
    </body>
    <script>
        var totalNum = 0;
        var LocStorage = null;

        appcan.ready(function() {
            //去除滚动条
            uexWindow.setWindowScrollbarVisible('false');
            appcan.frame.setBounce([0, 1], function(type) {
                $("#pullstatus").html("");
            }, function(type) {
                $("#pullstatus").html("");
            }, function(type) {
                appcan.frame.resetBounce(type);
                if (type == 0) {
                    offset = 1;
                } else {
                    var num = Number(pageNo) * limit;
                 
                    if (Number(totalNum) <= num) {
                        $("#pullstatus" ).html("");
                        appcan.window.openToast({
                            msg : '无更多信息',
                            duration : 1000,
                            position : 5,
                            type : 0
                        });
                        return;
                    }
                }
                newPageNo = Number(pageNo) + 1;
                getOrder(newPageNo);
            })
            getOrder();
            appcan.window.subscribe("cancelYXD", function(cancelYXD) {
                if (cancelYXD == "true") {
                    //window.location.reload();
                    reload();
                    appcan.window.openToast({
                        msg : '意向单已取消',
                        duration : 1000,
                        position : 5,
                        type : 0
                    });
                }
            })
            appcan.window.subscribe("payPopOrderId", function(orderId) {
                appcan.locStorage.setVal("payorderId", orderId);
                appcan.window.open("intentionPay", "intentionPay.html", 10);
            })
            appcan.window.subscribe("tiaoguo", function(tiaoguo) {
                if (tiaoguo == "true") {

                    reload();
                }
            })
            // 获取所属公司id以及name
            checkedAll();
        })
        function reload() {

            $("#listdetail").html("");
            getOrder();
        }

        function getOrder(newPageNo) {
            var pageNo = newPageNo?newPageNo:1;
            var url = URL + "/app/bill/getAllStatement";

            var paramJsonStr = "pageNo=" + pageNo + "&pageSize=" + pageSize;
            var func = getOrderCallBack;
            var dataType = "text";
            ajaxPostQuery(url, paramJsonStr, func, dataType);
            openToast();
        }

        function getOrderCallBack(data) {
            closeToast();
            if ( typeof data == "string") {
                data = JSON.parse(data);
            }
            // 油库数据
             totalRows = data.totalRows; // 总页数
            
            var oildepotList = data.oildepotList;
            window.oildepotList = oildepotList;

            var orderList = data.list;
            if (orderList.length == 0) {
                var listhtml = "<div id='nodata' class='ub ub-pc' style='margin: 0.8em 0;'>" + "<span class='mf-size2 nodata'>暂无数据</span>" + "</div>";
                $("#listdetail").html("");
                $("#listdetail").append(listhtml);

                return;

            } else if (orderList.length > 0) {
                var html = template("test", {
                    list : orderList
                });

                $("#listdetail").append(html);

            }

        }
     
        function checkedAll() {
            var url = URL + "/app/bill/checkedAll";

            var paramJsonStr = "";
            var func = getcheckNameCallBack;
            var dataType = "text";
            ajaxPostQuery(url, paramJsonStr, func, dataType);
        }

        function getcheckNameCallBack(data) {
            if ( typeof data == "string") {
                var data = JSON.parse(data);
            }

            window.data = data;
            IntoData = data;
            appcan.locStorage.setVal('data', data);
            return data;

        }

        //所属公司
        template.defaults.imports.getFgs = function(CodeId) {

            var listData = appcan.locStorage.getVal('data');
            var IntoData = window.data;
            // console.log('LocStorage' + listData)
            // console.log(IntoData)

            var companyName = '';
            // var IntoData = JSON.parse(listData);
            for (var i = 0; i < IntoData.length; i++) {

                if (IntoData[i].orgId == CodeId) {
                    companyName = IntoData[i].orgName;
                }
            }
            return companyName;

        }
        //格式化金额
        template.defaults.imports.Fmoney = function(price) {

            var newPrice = fmoney(price, 2);
            return newPrice;
        }
        // 油库地点

        template.defaults.imports.getYkdd = function(ykddVal) {

            for (var j = 0; j < oildepotList.length; j++) {
                if (ykddVal === oildepotList[j].oildepotId) {
                    return oildepotList[j].depotName;
                    break;
                }

            }

        }
        //提交数据回调
        function newPayOrderCallBack(data) {
            if (data == "ok") {

            }
        }


        appcan.button(".nav-btn", "btn-act", function() {
            appcan.window.close(-1);
        })
    </script>
</html>