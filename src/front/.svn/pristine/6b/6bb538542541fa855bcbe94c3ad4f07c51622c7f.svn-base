<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">
    <head>
        <title></title>
        <meta charset="utf-8">
        <meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <link rel="stylesheet" href="../css/fonts/font-awesome.min.css">
        <link rel="stylesheet" href="../build/css/ui-box.css">
        <link rel="stylesheet" href="../build/css/ui-base.css">
        <link rel="stylesheet" href="../build/css/ui-color.css">
        <link rel="stylesheet" href="../build/css/appcan.control.css">
        <link rel="stylesheet" href="css/common_page.css"/>
    </head>
    <body class="pop-body" ontouchstart>

        <div class="pop-wrapper">
            <div class="pop-content">
                <div class="pop-info">
                    <div class="uinput ub bc-border uba">
                        <input placeholder="" type="number" class="ub-f1" id="code" name="code">
                        <button type="button" class="ub ub-ac m-act2 btn-vcode" id="message" onclick="getValidCode()"> 获取验证码 </button>
                    </div>
                     <div id="retStr" class="pop-tip mf-size1"></div>
                </div>   
                
                <div id="btn" class="ub ub-ac ">   
                    <div id="cancelBtn" class="uinn5 ubt ubr bc-border ub ub-f1 ub-pc">
                        <span class="mf-color">取消</span>
                    </div>
                     <div id="confirmBtn" class="uinn5 ubt bc-border ub ub-f1 ub-pc">
                        <span class="mf-color">确认</span>
                    </div>
                </div>
            </div>
        </div>

        <script src="../build/js/appcan.js"></script>
        <script src="../build/js/appcan.control.js"></script>
        <script src="../common/comm.js"></script>
    </body>
    <script>
        var countdown=100;
        appcan.ready(function() {
            appcan.initBounce();
        })

        function getValidCode(){
            appcan.window.publish('smsValid', "true");
                closepop();
            var url = URL + "/comm/user/onlySendSMSByCusId";
            var paramJsonStr = "";
            var func = sendSMSCallBack;
            var dataType = "text";
            ajaxPostQuery(url, paramJsonStr, func, dataType);
            
            $("#message")[0].innerHTML="请在<span id='time'></span>秒内输入验证码";  
            setTimeInterval();
        }
        
        var phoneNum ="";
        function sendSMSCallBack(data){
            if (typeof data == "string") {
                data = eval("(" + data + ")");
            }
            phoneNum = data.phone;
            var retStr = data.retStr;
            $("#retStr")[0].innerHTML = retStr;
        }
        function setTimeInterval(){
            window.setTimeout('setTimeInterval()',1000);  //设置的时间函数
            if(countdown>0){   
                document.getElementById("time").innerHTML=countdown;   
                countdown--;   
            }else{
                $("#message")[0].innerHTML="重新获取验证码";
                countdown=100;
            }
        }
        appcan.button("#confirmBtn", "act-ani", function(){
            var code = $("#code")[0].value;
            var url = URL + "/comm/user/onlyValidateSMS";
            var paramJsonStr = "phone=" + phoneNum + "&code=" + code;
            var func = onlyValidateSMSCallBack;
            var dataType = "text";
            ajaxPostQuery(url, paramJsonStr, func, dataType);
            appcan.window.openToast('正在验证...', '0', '5', '1');
        })
        function onlyValidateSMSCallBack(data){
            appcan.window.closeToast();
            if(data=="true"){
                appcan.window.publish('smsValid', "true");
                closepop();
            }else{
                $("#retStr")[0].innerHTML = "验证码错误，请重新输入！";
            }
        }
        
        appcan.button("#cancelBtn", "act-ani", function(){
            closepop();
        })
        
        //关闭浮动窗口
        function closepop() {
            appcan.closePopover("validMsg");
        }
        

    </script>
</html>