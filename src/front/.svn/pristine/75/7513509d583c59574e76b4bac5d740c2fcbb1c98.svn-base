<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">

<head>
    <title></title>
    <meta charset="utf-8">
    <meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link rel="stylesheet" href="../build/css/fonts/font-awesome.min.css">
    <link rel="stylesheet" href="../build/css/ui-box.css">
    <link rel="stylesheet" href="../build/css/ui-base.css">
    <link rel="stylesheet" href="../build/css/ui-color.css">
    <link rel="stylesheet" href="../build/css/appcan.control.css">
    <link rel="stylesheet" href="css/common_page.css" />
</head>

<body class="pop-body" ontouchstart>

    <div class="pop-wrapper">
        <div class="pop-content">
            <div class="pop-info">
                <div class="uinput ub ub-f1">
                    <label for="code" class="ub-f1 ub-ac ub-pc" id="searchLabel" style="line-height: 2em;"></label>
                    <input placeholder="" type="text" class="ub-f1 uba  bc-border" id="code" name="code" style="border:1px solid #ccc;padding:.2em 0;border-radius: 3px;">

                </div>
            </div>

            <div id="btn" class="ub ub-ac ">
                <div id="cancelBtn" class="uinn5 ubt ubr bc-border ub ub-f1 ub-pc">
                    <span class="mf-color">取消</span>
                </div>
                <div id="confirmBtn" class="uinn5 ubt bc-border ub ub-f1 ub-pc">
                    <span class="mf-color">确认</span>
                </div>
            </div>
        </div>
    </div>

    <script src="../build/js/appcan.js"></script>
    <script src="../build/js/appcan.control.js"></script>
    <script src="../common/comm.js"></script>
    <script src="../common/jquery.min.js"></script>
</body>
<script>
    var SEARCH_DATA = null;
    appcan.ready(function () {
        initSearchLayout();
    })

    var mock = {
        type: "yayun",
        json: {
            "text": '押运员姓名',
            "url": '/app/cus/driver/queryCusDriver',
            "param": '&temp=0'
        }
    }

    function initSearchLayout() {
        SEARCH_DATA = JSON.parse(getVal("searchData"));

        $("#searchLabel").html(SEARCH_DATA.json.text+':');
        // 名称
        // $("#searchLabel").html(SEARCH_DATA.json.text + ":");

    }

    appcan.button("#confirmBtn", "act-ani", function () {
        var text = $("#code").val();
        if (text !== "") {
            switch (SEARCH_DATA.type) {
                case "siji":
                    var paramJsonStr = SEARCH_DATA.json.param + "&driverName=" + text,
                        url = SEARCH_DATA.json.url,
                        func = showSiJiList,
                        dataType = "text";
                    ajaxPostQuery(url, paramJsonStr, func, dataType);
                    appcan.window.openToast('加载中...', '0', '5', '1');
                    break;
                case "yayun":
                    var paramJsonStr = SEARCH_DATA.json.param + "&driverName=" + text + "&pager.pageNo=" +
                        pageNo + "&pager.pageSize=" + 500,
                        url = SEARCH_DATA.json.url,
                        func = showYaYunList,
                        dataType = "text";
                    ajaxPostQuery(url, paramJsonStr, func, dataType);
                    appcan.window.openToast('加载中...', '0', '5', '1');
                    break;

                default:
                    break;
            }

        } else {
            oneAlert("请输入需要查询的字段，不可为空!")
        }


    })

    function showYaYunList(data) {
        appcan.window.closeToast();
        if (typeof data === 'string') {
            var json = JSON.parse(data);
            setVal("searchData", {
                type: "yayun",
                data: json.rows
            })
            console.log(json);

            appcan.window.publish('getSearchData', "true");
            uexWindow.evaluatePopoverScript("yayun", "content", "getNewYaYunData()");
            closepop();
        } else {
            oneAlert("查询结果出错，请稍后重新输入！")
        }
    }

    function showSiJiList(data) {

    }

    appcan.button("#cancelBtn", "act-ani", function () {
        closepop();
    })

    //关闭浮动窗口
    function closepop() {
        appcan.closePopover("searchTpl");
    }
</script>

</html>