<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">

<head>
    <title></title>
    <meta charset="utf-8">
    <meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link rel="stylesheet" href="../build/css/fonts/font-awesome.min.css">
    <link rel="stylesheet" href="../build/css/ui-box.css">
    <link rel="stylesheet" href="../build/css/ui-base.css">
    <link rel="stylesheet" href="../build/css/ui-color.css">
    <link rel="stylesheet" href="../build/css/appcan.icon.css">
    <link rel="stylesheet" href="../build/css/appcan.control.css">
    <link rel="stylesheet" href="css/intentionList.css">
    <link rel="stylesheet" type="text/css" href="./css/search.css" />

</head>

<body class="um-vp bc-bg" ontouchstart>
    <!--header开始-->
    <div id="header" class="fix uh bc-text-head ub bc-head">
        <div class="nav-btn" id="nav-left">
            <div class="t-btn-a1 ub-img uwh-tBtn fa fa-angle-left fa-2x"></div>
        </div>
        <h1 class="ut ub-f1 ulev-3 ut-s tx-c" tabindex="0">客存</h1>
        <div class="nav-btn nav-bt" id="nav-right"></div>
    </div>
    <div id="header1" class="uh bc-text-head ub bc-head">
        <div class="nav-btn" id="nav-left">
            <div class="t-btn-a1 ub-img uwh-tBtn fa fa-angle-left fa-2x"></div>
        </div>
        <h1 class="ut ub-f1 ulev-3 ut-s tx-c" tabindex="0">隐藏</h1>
        <div class="nav-btn nav-bt" id="nav-right"></div>
    </div>
    <div id="content">

    </div>

    <script id="test" type="text/html">

        {{each list}}
        <div id='list" + i + "' class='list-content white-bg'>
            <div id='orderlist" + i + "'>

                <div id='' class='ub ub-ac umar-a m-row3'>
                    <div id='' class='ub ub-ac t-col1'>
                        <!-- 油品名称 -->

                        {{$value.OILINFO_NAME}}

                    </div>
                    <div id='' class='ub ub-ac ub-pc t-col2'>
                        <span class="gray-font">订单量</span>
                        <span class='umar-r mf-color umar-r'>

                            {{$value.ordernum}}

                            <!-- 油品数量-->

                        </span>
                        <span class='gray-font mf-size2'>/吨</span>
                    </div>
                </div>
                <div id='pay' class='ub ub-ac umar-l umar-r m-row3'>
                    <div id='' class='col-left'>
                        <span class='gray-font'>结算单量&nbsp;&nbsp;</span>
                        <span>
                            {{$value.statementnum}}
                            <span class='gray-font mf-size2'>/吨</span>
                        </span>
                    </div>
                    <div id='total' class='col-right'>
                        <span class='gray-font'>通知单量&nbsp;&nbsp;
                            <span class='mf-color AllPrice'>
                                {{$value.noticenum}}
                            </span>
                            <span class='gray-font mf-size2'>/吨</span>
                    </div>
                </div>

                <div id='pay' class='ub ub-ac umar-l umar-r m-row3'>
                    <div id='' class='col-left'>
                        <span class='gray-font'>出库量&nbsp;&nbsp;</span>
                        <span>
                            {{$value.outnum}}
                            <span class='gray-font mf-size2'>/吨</span>
                        </span>
                    </div>
                    <div id='total' class='col-right'>
                        <span class='gray-font'>剩余量&nbsp;&nbsp;
                            <span style="color:#000">
                                {{$value.shenyu}}
                                <span class='gray-font mf-size2'>/吨</span>
                            </span>
                            <span class='mf-color AllPrice'>

                            </span>
                    </div>
                </div>
                <div id='' class='ub ub-ac umar-l umar-r m-row3'>
                    <div id='' class='col-left'>
                        <span class='gray-font'>已开未提量&nbsp;&nbsp;</span>
                        <span>
                            {{$value.yikaiweiti}}
                            <span class='gray-font mf-size2'>/吨</span>
                        </span>
                    </div>
                    <div id='total' class='col-right'>
                        <span class='gray-font'>可下计划量&nbsp;&nbsp;
                            <span style="color:#000">
                                {{$value.kexiajihualiang}}
                                <span class='gray-font mf-size2'>/吨</span>
                            </span>
                            <span class='mf-color AllPrice'>

                            </span>
                    </div>
                </div>

                <div id='' class='ub ub-ac umar-l umar-r m-row3'>
                    <div id='' class='col-left'>
                        <span class='gray-font'>客存&nbsp;&nbsp;</span>
                        <span>
                            {{$value.kecun}}
                            <span class='gray-font mf-size2'>/吨</span>
                        </span>
                    </div>
                    <div id='total' class='col-right'>
                        <span class='gray-font'>已购未提&nbsp;&nbsp;
                            <span style="color:#000">
                                {{$value.yigouweiti}}
                                <span class='gray-font mf-size2'>/吨</span>
                            </span>
                            <span class='mf-color AllPrice'>

                            </span>
                    </div>
                </div>

            </div>
        </div>
        <div class='gap'></div>
        {{/each}}
    </script>
    <script src="../build/js/appcan.js"></script>
    <script src="../build/js/appcan.control.js"></script>
    <script src="../common/comm.js"></script>
    <script type="text/javascript" charset="utf-8" src="../common/template-web.js"></script>
</body>
<script type="text/javascript" charset="utf-8">
    appcan.button(".nav-btn", "btn-act", function () {
        appcan.window.close(-1);
    })
    appcan.ready(function () {
        uexWindow.setWindowScrollbarVisible('false');
        getdeposit();
    })

    function getdeposit() {

        var url = URL + "/app/report/kecunReportList";
        var cusId = appcan.locStorage.getVal('cusId');
        var paramJsonStr = "cusId=" + cusId;
        var func = getdepositCallBack;
        var dataType = "text";
        ajaxPostQuery(url, paramJsonStr, func, dataType);
        openToast();
    }

    function getdepositCallBack(data) {
        closeToast();
        if (typeof data == 'string' && data != '') {
            var data = JSON.parse(data);
        }
        if (!data || data == '' || data == {} || !data.rows) {
            nodata('content', '您没有符合条件的付油通知单')
            return;
        }

        var listOrder = data.rows;
        var cusType = data.cusType;
        for (var i = 0; i < listOrder.length; i++) {

            var ordernum = listOrder[i].ordernum ? listOrder[i].ordernum : 0;
            // 结算量=结算表的实际结算量
            var statementnum = listOrder[i].statementnum ? listOrder[i].statementnum : 0;
            var noticenum = listOrder[i].noticenum ? listOrder[i].noticenum : 0;
            var outnum = listOrder[i].outnum ? listOrder[i].outnum : 0;
            var shengyu = listOrder[i].shengyu ? listOrder[i].shengyu : 0;
            var yikaiweiti = listOrder[i].yikaiweiti ? listOrder[i].yikaiweiti : 0;
            var guanlianyikaiweiti = listOrder[i].guanlianyikaiweiti ? listOrder[i].guanlianyikaiweiti : 0;
            var kexiajihualiang = listOrder[i].kexiajihualiang ? listOrder[i].kexiajihualiang : 0;
            var kecun = listOrder[i].kecun ? listOrder[i].kecun : 0;
            var yigouweiti = listOrder[i].yigouweiti ? listOrder[i].yigouweiti : 0;
            var guanlianoutnum = listOrder[i].guanlianoutnum ? listOrder[i].guanlianoutnum : 0;

            if (cusType == "普通客户") {
                //出库量=出库表的实际出库量
                listOrder[i].outnum = parseFloat(outnum).toFixed(3);
                //剩余量=订单量-出库表的实际出库量
                listOrder[i].shenyu = parseFloat(ordernum - outnum).toFixed(3);
                //已开未提=出库表状态为未出库的
                listOrder[i].yikaiweiti = parseFloat(yikaiweiti).toFixed(3);
                //可下计划量=付油通知单量-出库量-已开未提
                listOrder[i].kexiajihualiang = parseFloat(ordernum - outnum - yikaiweiti).toFixed(3);
                //客存=结算量-出库量
                listOrder[i].kecun = parseFloat(statementnum - outnum).toFixed(3);
                //已购未提=订单量-出库量
                listOrder[i].yigouweiti = parseFloat(ordernum - outnum).toFixed(3);

            } else {
                //出库量=出库表的实际出库量+关联的出库量
                listOrder[i].outnum = parseFloat(outnum).toFixed(3);
                //剩余量=订单量-出库表的实际出库量-关联的出库量
                listOrder[i].shenyu = parseFloat(ordernum - outnum).toFixed(3)
                //已开未提=出库表状态为未出库的
                listOrder[i].yikaiweiti = parseFloat(yikaiweiti + guanlianyikaiweiti).toFixed(3);
                //可下计划量=付油通知单量-出库表的实际出库量-关联的出库量-已开未提
                listOrder[i].kexiajihualiang = parseFloat(ordernum - outnum - yikaiweiti - guanlianyikaiweiti).toFixed(
                    3)
                //客存=结算量-出库量;
                listOrder[i].kecun = parseFloat(statementnum - outnum).toFixed(3);
                //已购未提=订单量-出库量
                listOrder[i].yigouweiti = parseFloat(ordernum - outnum).toFixed(3);
            }
        }
        if (listOrder.length == 0) {
            nodata('content', '您没有符合条件的付油通知单')
            return;
        }

        var html = template('test', {
            list: listOrder
        })
        // console.log(html)
        $(content).html(html)
    }
</script>

</html>