<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">

<head>
    <title></title>
    <meta charset="utf-8">
    <meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link rel="stylesheet" href="../build/css/fonts/font-awesome.min.css">
    <link rel="stylesheet" href="../build/css/ui-box.css">
    <link rel="stylesheet" href="../build/css/ui-base.css">
    <link rel="stylesheet" href="../build/css/ui-color.css">
    <link rel="stylesheet" href="../build/css/appcan.icon.css">
    <link rel="stylesheet" href="../build/css/appcan.control.css">

    <script src="../common/comm.js"></script>
</head>

<body class="um-vp bc-bg" ontouchstart style="position: relative;">


    <div class="wrapper pop-window">
        <input type="hidden" id="biaoshi" name="biaoshi" />

        <form action="" id="myFormId" class="judge-form">

            <p class="margin-t-2x" style="margin-left: 2em;">
                <i></i>
                <span>所属公司：</span>

                <select id="fgs" name="gyfgs" class="mySelect ellipsis" style="font-size:1em;width: 8.625em;">

                </select>
            </p>



            <div id="btn" class="ub ub-ac">
                <div id="confirmBtn" class="uinn5 ubt ubr bc-border ub ub-f1 ub-pc">
                    <span class="mf-color" onclick="Choose()">确认</span>
                </div>
                <div id="cancelBtn" class="uinn5 ubt bc-border ub ub-f1 ub-pc">
                    <span class="mf-color" onclick="cancel()">关闭</span>
                </div>
            </div>
        </form>

    </div>



    <script src="../build/js/appcan.js"></script>
    <script src="../build/js/appcan.control.js"></script>
    <script src="../common/template-web.js" type="text/javascript" charset="utf-8">
    </script>
    <script id="Toast" type="text/html">
        {{each list}}
        <option id={{$value.orgId}} onclick="" value={{$value.orgId}}>{{$value.orgName}}</option>

        {{/each}}

    </script>
</body>
<script>
    appcan.ready(function () {
        lectCompany();
    });
    //查询所有可授权的分公司
    function lectCompany() {
        $(".wrapper")[0].style.display = 'block';
        var url = URL + "/app/cus/selectCompany";

        var paramJsonStr = "";
        var func = showToastList;
        var dataType = "text";
        ajaxPostQuery(url, paramJsonStr, func, dataType);
        appcan.window.openToast('正在加载...', '0', '5', '1');
    }

    function showToastList(data) {

        appcan.window.closeToast();

        if (typeof data == "string") {
            data = JSON.parse(data);
        };

        var html = template('Toast', {
            list: data
        });

        $('#fgs').html(html);

    }
    //确认新添加分公司
    function Choose() {

        var url = URL + "/app/cus/addCompany";
        var basOrgId = $('#fgs')[0].value;

        var paramJsonStr = "basOrgId=" + basOrgId;

        var AlreadyCompany = JSON.parse(appcan.locStorage.getVal("FGS_list"));

        if (isIncluded(basOrgId, AlreadyCompany)) {
            appcan.window.alert({
                title: '提示',
                content: "该分公司已被添加！",
                buttons: '确定'
            });
            return;
        }

        var func = SubmitBasOrgId;
        var dataType = "text";
        ajaxPostQuery(url, paramJsonStr, func, dataType);
        appcan.window.openToast('正在加载...', '0', '5', '1');

    }

    function SubmitBasOrgId(data) {

        appcan.window.closeToast();

        if (typeof data == "string") {
            data = JSON.parse(data)
        };
        $(".wrapper")[0].style.display = 'none';

        if (data == '1') {
            uexWindow.evaluateScript("gyfgs", 0, "addGyfgsSuccess()");

        } else if (data == "0") {
            appcan.window.alert({
                title: '提示',
                content: "添加失败，请重试！",
                buttons: '确定'
            });
        }

    }

    function cancel() {

        $(".wrapper")[0].style.display = 'none';

    }
</script>

</html>