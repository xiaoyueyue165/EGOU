<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">

<head>
    <title></title>
    <meta charset="utf-8">
    <meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link rel="stylesheet" href="../build/css/fonts/font-awesome.min.css">
    <link rel="stylesheet" href="../build/css/ui-box.css">
    <link rel="stylesheet" href="../build/css/ui-base.css">
    <link rel="stylesheet" href="../build/css/ui-color.css">
    <link rel="stylesheet" href="../build/css/appcan.icon.css">
    <link rel="stylesheet" href="../build/css/appcan.control.css">
    <link rel="stylesheet" href="./css/userpage.css">
    <link rel="stylesheet" type="text/css" href="../buyOil/css/quickbuy.css" />
    <style type="text/css">
        #infoList {
            width: 100%;
            background-color: #fff;
            height: 20em;
            overflow-y: scroll;
        }
    </style>
</head>

<body class="um-vp " ontouchstart>
    <div id="page_0" class="up ub ub-ver bc-bg" tabindex="0">

        <!--header开始-->
        <div id="header" class="uh bc-text-head ub bc-head">
            <div class="nav-btn" id="nav-left">
                <div class="t-btn-a1 ub-img uwh-tBtn fa fa-angle-left fa-2x"></div>
            </div>
            <h1 class="ut ub-f1 ulev-3 ut-s tx-c" tabindex="0">请选择购油的单位</h1>
            <div class="nav-btn nav-bt" id="nav-right">
                <div id="search" class="umar-r myicon myicon-search"></div>

            </div>
        </div>
        <!--header结束-->

        <!-- 搜索框 -->
        <div class="wrapper pop-window">
            <input type="hidden" id="biaoshi" name="biaoshi" />

            <form action="" id="myFormId" class="judge-form">

                <p class="margin-t-2x" style="margin-left: 2em;">
                    <i></i>
                    <span>公司名称：</span>

                    <input class="m-input" type="text" name="num" id="searchVal" value="" style="text-align: left;width:8.625em ">
                </p>

                <div id="btn" class="ub ub-ac">
                    <div id="confirmBtn" class="uinn5 ubt ubr bc-border ub ub-f1 ub-pc">
                        <span class="mf-color" onclick="CompSearch()">查询</span>
                    </div>
                    <div id="cancelBtn" class="uinn5 ubt bc-border ub ub-f1 ub-pc">
                        <span class="mf-color" onclick="cancel()">关闭</span>
                    </div>
                </div>
            </form>

        </div>

        <!--content开始-->

        <div id="content" class="ub-f1 tx-l">

            <div id="listview" class="ubt bc-border sc-bg mf-size1"></div>

            <div id="infoList">

            </div>
            <div class="uhide btn ub ub-ac ub-pc bc-text-head bc-btn uc-a1 mp-btn" id="submit" onclick="subChoose();" style="margin:1em 0.4em">
                提交
            </div>

        </div>
        <!--content结束-->
    </div>
    <script src="../build/js/appcan.js"></script>
    <script src="../build/js/appcan.control.js"></script>
    <script src="../build/js/appcan.listview.js"></script>
    <script type="text/javascript" charset="utf-8" src="../common/comm.js"></script>
</body>
<script>
    appcan.ready(function () {
        //去除滚动条
        uexWindow.setWindowScrollbarVisible('false');

        var titHeight = $('#header').offset().height;
        window.onorientationchange = window.onresize = function () {
            appcan.frame.resize("content", 0, titHeight);
        }
        queryUserList();

        appcan.button("#nav-left", "btn-act", function () {
            appcan.window.close(-1);
        })
        appcan.button("#nav-right", "btn-act", function () {

            document.getElementsByClassName('wrapper')[0].style.display = 'block';
        })
    });

    function queryUserList() {
        var url = URL + "/comm/user/queryUserList";
        //访问路径
        var userId = appcan.locStorage.getVal("userId");
        // alert(userId)
        var paramJsonStr = "userId=" + userId;
        //参数
        var func = showUserList;
        //返回的方法
        var dataType = "text";
        ajaxPostQueryDNnotVerifySid(url, paramJsonStr, func, dataType);
        appcan.window.openToast('加载中...', '0', '5', '1');

    }

    function cancel() {
        $(".wrapper")[0].style.display = 'none';
    }

    // 搜索公司名称
    function CompSearch() {
        var searchData = document.getElementById('searchVal').value;
        var url = URL + "/comm/user/queryUserList";
        //访问路径
        var cusId = appcan.locStorage.getVal("cusId");
        var userId = appcan.locStorage.getVal('userId');

        var paramJsonStr = "userId=" + userId + "&cusCompany=" + searchData;

        var func = showUserList;

        var dataType = "text";
        ajaxPostQueryDNnotVerifySid(url, paramJsonStr, func, dataType);
        appcan.window.openToast('加载中...', '0', '5', '1');

    }

    $(".wrapper")[0].style.display = 'none';

    function showUserList(data) {
        appcan.window.closeToast();
        if (typeof data == "string") {
            data = JSON.parse(data)
        }

        var pList = data.pojoList,
            str = "";
        if (!pList || pList.length == 0) {
            var listhtml = "<div id='time' class='ub ub-pc' style='margin: 0.8em 0;'>" +
                "<span class='mf-size2 time'>暂无账户数据可切换</span>" + "</div>";

            $("#content").append(listhtml);
            return;
        }
        for (var i = 1; i <= pList.length; i++) {

            var cusCompany = pList[i - 1].cusCompany;
            var cusId = pList[i - 1].cusId;

            if (i - 1 == 0) {

                str += '<div class="ubb ub bc-border bc-text ub-ac lis">' +
                    '<div class="radiobox umar-r" name=""><input  id="radio_' + i +
                    '" type="radio" checked="checked" class="uabs ub-con" name="radioStation" company="' + cusCompany +
                    '"  value="' + cusId + '">' + '</div>' + cusCompany + '</div>';
            } else {
                str += '<div class="ubb ub bc-border bc-text ub-ac lis">' +
                    '<div class="radiobox umar-r" name=""><input  id="radio_' + i +
                    '" type="radio" class="uabs ub-con" name="radioStation" company="' + cusCompany + '" value="' +
                    cusId + '">' + '</div>' + cusCompany + '</div>';
            }

        }
        $("#infoList").html(str);
        document.getElementById("submit").classList.remove("uhide");

    }

    function subChoose() {

        //数据
        var chkObjs = document.getElementsByName("radioStation");
        var cusID = "";
        for (var i = 0; i < chkObjs.length; i++) {
            if (chkObjs[i].checked) {
                //chk = i;
                cusID = chkObjs[i].value;

                appcan.locStorage.setVal("cusId", cusID);

                var cusCompany = chkObjs[i].getAttribute('company');

                appcan.locStorage.setVal('cusCompany', cusCompany);
                appcan.window.publish("company", cusCompany);
            }
        }

        var url = URL + "/comm/user/subChooseUser";
        //访问路径
        var cusId = appcan.locStorage.getVal("cusId");
        appcan.locStorage.setVal('isPerson', true);


        var paramJsonStr = "cusId=" + cusId;

        var func = showindexPage;

        var dataType = "text";
        ajaxPostQueryDNnotVerifySid(url, paramJsonStr, func, dataType);
        appcan.window.openToast('加载中...', '0', '5', '1');

    }

    ListenEnter(subChoose);

    function showindexPage(data) {

        var CompData = JSON.parse(data);

        appcan.window.publish("userForCompany", CompData.userForCompany);

        appcan.window.open("index", "../index.html", 5);

    }
</script>

</html>