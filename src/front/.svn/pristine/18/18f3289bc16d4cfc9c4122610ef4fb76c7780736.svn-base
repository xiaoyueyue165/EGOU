<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">

<head>
    <title></title>
    <meta charset="utf-8">
    <meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link rel="stylesheet" href="../build/css/fonts/font-awesome.min.css">
    <link rel="stylesheet" href="../build/css/ui-box.css">
    <link rel="stylesheet" href="../build/css/ui-base.css">
    <link rel="stylesheet" href="../build/css/ui-color.css">
    <link rel="stylesheet" href="../build/css/appcan.icon.css">
    <link rel="stylesheet" href="../build/css/appcan.control.css">
    <link rel="stylesheet" href="css/infomgmt.css">
    <script src="../common/comm.js"></script>
</head>

<body class="um-vp bc-bg" ontouchstart>
    <div class="user-info">
        <div class="ub ub-ver white-bg mf-size1 b-border" id="siteInfo">
        </div>
        <div class="umar-a margin-t-l">
            <div class="btn ub ub-ac bc-text-head ub-pc bc-btn mp-btn" id="btn-sava-siteInfo">
                保&nbsp; &nbsp;存
            </div>
        </div>

    </div>
    <script src="../build/js/appcan.js"></script>
    <script src="../build/js/appcan.control.js"></script>
    <script src="../build/js/appcan.listview.js"></script>
</body>
<script>
    var gasstationId = "";
    var siteInfo = "";
    var ifModify = false;
    var gasstationName = "";
    var gasstationLeader = "";
    var mobile = "";
    var area = "";
    var address = "";
    var lv_area;
    var beforeSiteStr = "";
    var params = null;

    appcan.ready(function () {
        params = {
            width: window.screen.width,
            height: 300,
            src: "res://shanghai.json", //"res://test.json"
            select: [0, 0, 0]
        };
        try {
             = function (data) {
                if (typeof (json) == "string") {
                    data = JSON.parse(data)
                }
                var areaArr = data.data;
                area = areaArr[0] + " " + areaArr[1] + " " + areaArr[2];

                lv_area.set([{
                    title: area
                }]);
                uexWheelPickView.close();
            }
            gasstationId = appcan.locStorage.getVal("gasstationId");
            siteInfo = appcan.locStorage.getVal("siteInfo");
            beforeSiteStr =
                appcan.locStorage.getVal("beforeSiteStr");
            appcan.locStorage.remove("gasstationId");
            appcan.locStorage.remove(
                "siteInfo");

            initSiteInfo();
        } catch (error) {
            gasstationId = appcan.locStorage.getVal("gasstationId");
            siteInfo = appcan.locStorage.getVal("siteInfo");
            beforeSiteStr =
                appcan.locStorage.getVal("beforeSiteStr");
            appcan.locStorage.remove("gasstationId");
            appcan.locStorage.remove(
                "siteInfo");

            initSiteInfo();
        }



    });

    function initSiteInfo() {
        if (gasstationId == "" || gasstationId == null) {
            ifModify = false;

        } else {

            ifModify = true;
            if (typeof siteInfo == "string") {
                siteInfo = eval("(" + siteInfo + ")");
            }
            gasstationName = siteInfo.gasstationName;
            gasstationLeader = siteInfo.gasstationLeader;
            mobile = siteInfo.mobile;
            area = siteInfo.area;
            address = siteInfo.address;
        }

        var staNameString =
            '<div class="ub m-row umar-l umar-r"><div class="ub ub-ac l-width"><span class="gray-font">网点名称</span>' +
            '</div><div class="ub ub-ac ub-f1"><div class="uinput ub ub-f1">' +
            '<input placeholder="" type="text" class="ub-f1" value="' +
            gasstationName + '">' +
            '</div></div></div>';
        var leaderString =
            '<div class="ub m-row umar-l umar-r"><div class="ub ub-ac l-width"><span class="gray-font">负责人姓名</span>' +
            '</div><div class="ub ub-ac ub-f1"><div class="uinput ub ub-f1">' +
            '<input placeholder="" type="text" class="ub-f1" value="' +
            gasstationLeader + '">' +
            '</div></div></div>';
        var mobileString =
            '<div class="ub m-row umar-l umar-r"><div class="ub ub-ac l-width"><span class="gray-font">手机号</span>' +
            '</div><div class="ub ub-ac ub-f1"><div class="uinput ub ub-f1">' +
            '<input placeholder="" type="text" class="ub-f1" value="' +
            mobile + '">' +
            '</div></div></div>';
        var addressString =
            '<div class="ub m-row umar-l umar-r"><div class="ub ub-ac l-width"><span class="gray-font">所在地区</span>' +
            '</div><div class="ub ub-ac ub-f1"><div id="orgAddress" class="orgAddress-list"></div></div></div>';
        var addressInfoString =
            '<div class="ub m-row umar-l umar-r no-border-b"><div class="ub ub-ac l-width"><span class="gray-font">详细地址</span>' +
            '</div><div class="ub ub-ac ub-f1"><div class="uinput ub ub-f1">' +
            '<input placeholder="" type="text" class="ub-f1" value="' +
            address + '">' +
            '</div></div></div>';
        $("#siteInfo").append(staNameString + leaderString + mobileString + addressString + addressInfoString);
        initAreaList();
    }

    appcan.button("#btn-sava-siteInfo", "act-ani", function () {
        gasstationName = $("input")[0].value;
        gasstationLeader = $("input")[1].value;
        mobile = $("input")[2].value;
        address = $("input")[3].value;

        var isError = false;
        var errorToast = function (val, name, regx, message) {
            // 非空验证
            if (val === "") {
                appcan.window.alert("提示", name + "不能为空！", "确定");
                isError = true;
            }
            // 正则验证
            if (regx && message) {
                if (!regx.test(val)) {
                    appcan.window.alert("提示", message, "确定");
                    isError = true;
                }

            }
        }

        errorToast(gasstationName, "网点名称");
        if (isError) {
            return;
        }
        errorToast(gasstationLeader, "负责人姓名");
        if (isError) {
            return;
        }
        errorToast(mobile, "手机号");
        if (isError) {
            return;
        }
        errorToast(mobile, "手机号", /^(((13[0-9]{1})|(15[0-9]{1})|(17[0-9]{1})|(18[0-9]{1}))+\d{8})$/,
            "请输入有效的手机号码，长度为11位!");
        if (isError) {
            return;
        }
        errorToast(address, "详细地址");
        if (isError) {
            return;
        }

        var gasAreaArr = area.split(" ");
        if (gasAreaArr.length === 2) {
            var gasstationCity = gasAreaArr[0];
            var gasstationArea = gasAreaArr[1];
        } else {
            var gasstationCity = gasAreaArr[1];
            var gasstationArea = gasAreaArr[2];
        }
        var gasstationProvince = "上海市";
        var gasstationAddress = address;

        var url = "";
        var paramJsonStr = "";
        if (ifModify) { //编辑
            url = URL + "/app/cus/cusGasstation/updateCusGasstation";
            paramJsonStr = "gasstationId=" + gasstationId + "&gasstationName=" + gasstationName +
                "&gasstationCode=''" + "&gasstationLeader=" + gasstationLeader + "&officePhone=''" +
                "&mobile=" +
                mobile + "&gasstationProvince=" + gasstationProvince + "&gasstationCity=" + gasstationCity +
                "&gasstationArea=" + gasstationArea + "&gasstationAddress=" + gasstationAddress +
                "&gasstationLongandlat=''" + "&gasstationBuilding=''" + "&state=" + 0 + "&beforeAddress=" +
                beforeSiteStr;
        } else { //新增
            url = URL + "/app/cus/cusGasstation/addCusGasstation";
            paramJsonStr = "gasstationName=" + gasstationName + "&gasstationCode=''" + "&gasstationLeader=" +
                gasstationLeader + "&officePhone=''" + "&mobile=" + mobile + "&gasstationProvince=" +
                gasstationProvince + "&gasstationCity=" + gasstationCity + "&gasstationArea=" +
                gasstationArea +
                "&gasstationAddress=" + gasstationAddress + "&gasstationLongandlat=''" +
                "&gasstationBuilding=''" + "&state=" + 0;
        }
        var func = updateCallback;
        var dataType = "text";
        ajaxPostQuery(url, paramJsonStr, func, dataType);
        appcan.window.openToast('正在提交数据...', '0', '5', '1');
    })

    function updateCallback(data) {
        appcan.window.closeToast();
        if (data == "0") {
            uexWindow.evaluateScript("siteAdd", 0, "addSiteSuccess()");
        } else {
            appcan.window.alert({
                title: '提示',
                content: "保存失败，请重试！",
                buttons: '确定'
            });
        }
    }

    function initAreaList() {
        lv_area = appcan.listview({
            selector: "#orgAddress",
            type: "thinLine",
            hasAngle: true
        });
        lv_area.set([{
            title: area
        }])
        lv_area.on("click", function (ele, obj, curEle) {

            uexWheelPickView.open(params);
        })
    }
</script>

</html>