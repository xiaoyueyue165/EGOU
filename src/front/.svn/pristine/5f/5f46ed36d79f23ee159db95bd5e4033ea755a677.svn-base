<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">

<head>
    <title></title>
    <meta charset="utf-8">
    <meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link rel="stylesheet" href="../build/css/fonts/font-awesome.min.css">
    <link rel="stylesheet" href="../build/css/ui-box.css">
    <link rel="stylesheet" href="../build/css/ui-base.css">
    <link rel="stylesheet" href="../build/css/ui-color.css">
    <link rel="stylesheet" href="../build/css/appcan.icon.css">
    <link rel="stylesheet" href="../build/css/appcan.control.css">
    <link rel="stylesheet" href="css/register.css">
    <script type="text/javascript" src="../common/comm.js"></script>
</head>

<body class="um-vp bc-bg" ontouchstart>
    <!--header开始-->
    <div class="uh bc-text-head ub bc-head nav-style2" id="header">
        <div class="nav-btn" id="nav-left">
            <div class="t-btn-a1 ub-img uwh-tBtn fa fa-angle-left fa-2x gray-font"></div>
        </div>
        <h1 class="ut ub-f1 ulev-3 ut-s tx-c" tabindex="0">完善用户信息</h1>
        <div class="nav-btn" id="nav-right">
        </div>
    </div>
    <!--header结束-->
    <form id="myFormId" action="" method="post">
        <input type="text" name="loginName" id="loginName" value="" style="display:none;" />
        <input type="text" name="loginPassword" id="loginPassword" value="" style="display:none;" />
        <input type="text" name="sid" id="sid" value="" style="display:none;" />
        <input type="text" name="cusType" id="cusType" value="" style="display:none;" />

        <div class="user-info">
            <div class="ub ub-ver white-bg mf-size1 b-border">

                <div class="ub m-row umar-l umar-r">
                    <div class="ub ub-ac uw-reg">单位类型</div>
                    <div class="ub ub-pe ub-f1">
                        <div id="cusTypeName" class="org-list"></div>
                    </div>
                </div>

                <div class="ub m-row umar-l umar-r">
                    <div class="ub ub-ac uw-reg">
                        <span class="sc-text-warn"> * </span>单位名称</div>
                    <div class="ub ub-ac ub-f1">
                        <div class="uinput ub ub-f1">
                            <input placeholder="请填写单位名称" name="cusCompany" id="cusCompany" type="text" class="ub-f1">
                        </div>
                    </div>
                </div>
                <div class="ub m-row umar-l umar-r">
                    <div class="ub ub-ac uw-reg">
                        <span class="sc-text-warn"> * </span>
                        单位地址
                    </div>
                    <div class="ub ub-ac ub-f1">
                        <div class="uinput ub ub-f1">
                            <input placeholder="请如实填写详细收货地址" name="cusAddress" id="cusAddress" type="text" class="ub-f1">

                        </div>
                    </div>
                </div>
                <div class="ub m-row umar-l umar-r">
                    <div class="ub ub-ac uw-reg">
                        邮政编码
                    </div>
                    <div class="ub ub-ac  ub-f1">
                        <div class="uinput ub ub-f1">
                            <input placeholder="请如实填写邮政编码" name="cusPostcode" id="cusPostcode" type="text" class="ub-f1">
                        </div>
                    </div>
                </div>

                <div class="ub m-row umar-l umar-r">
                    <div class="ub ub-ac uw-reg">
                        <span class="sc-text-warn"> * </span>
                        联系人
                    </div>
                    <div class="ub ub-ac  ub-f1">
                        <div class="uinput ub ub-f1">
                            <input placeholder="请输入联系人姓名" name="cusLeader" id="cusLeader" type="text" class="ub-f1">

                        </div>
                    </div>
                </div>
                <div class="ub m-row umar-l umar-r">
                    <div class="ub ub-ac uw-reg">
                        电子邮件
                    </div>
                    <div class="ub ub-ac  ub-f1">
                        <div class="uinput ub ub-f1">
                            <input placeholder="请如实填写电子邮件" name="cusEmail" id="cusEmail" type="text" class="ub-f1">

                        </div>
                    </div>
                </div>
                <div class="ub m-row umar-l umar-r">
                    <div class="ub ub-ac uw-reg">
                        <span class="sc-text-warn"> * </span>
                        手机号
                    </div>
                    <div class="ub ub-ac  ub-f1">
                        <div class="uinput ub ub-f1">
                            <input placeholder="请如实填写手机号码" name="cusMobile" id="cusMobile" type="text" class="ub-f1">
                        </div>
                    </div>
                </div>

                <div class="ub m-row umar-l umar-r no-border-b">
                    <div class="ub ub-ac uw-reg">
                        <span class="sc-text-warn"> * </span>
                        验证码
                    </div>
                    <div class="ub ub-ac  ub-f1">
                        <div class="uinput ub ub-f1">
                            <input placeholder="" type="text" class="ub-f1" id="code" name="code">
                        </div>
                    </div>
                    <button type="button" class="ub ub-ac mp-btn2 btn-vcode" id="message"> 获取验证码 </button>
                </div>

            </div>
            <div class=" ub uinn-at1 ub-pj action-group">
                <div class="btn ub ub-ac bc-text-head ub-pc bc-btn btn-submit umar-a mp-btn2" id="btn-register-back">
                    返回上一步
                </div>
                <div class="btn ub ub-ac bc-text-head ub-pc bc-btn btn-submit umar-a mp-btn" id="btn-register-sub">
                    提交
                </div>
            </div>
        </div>
    </form>
    <script src="../build/js/appcan.js"></script>
    <script src="../build/js/appcan.control.js"></script>
    <script src="../build/js/appcan.listview.js"></script>
</body>
<script>
    window.onload = function () {
        var re_username = appcan.locStorage.getVal("re_username");
        var re_password = appcan.locStorage.getVal("re_password");
        document.getElementById("loginName").value = re_username;
        document.getElementById("loginPassword").value = re_password;
    }
    var name = "";
    appcan.ready(function () {
        appcan.window.subscribe('putKeyValue', function (listdata) {
            if (listdata == "") {
                lv.set([{
                    title: "请选择",
                }])
            } else {
                var id = listdata.substring(0, listdata.indexOf(','));
                name = listdata.substring(listdata.indexOf(',') + 1, listdata.length);
                lv.set([{
                    title: name,
                }])
                document.getElementById("cusType").value = id;
            }
        })
        appcan.initBounce();
    })

    appcan.button("#nav-left", "btn-act", function () {
        appcan.window.close(-1);

    })

    appcan.button("#btn-register-back", "ani-act", function () {
        appcan.window.close(-1);

    })


    appcan.button("#btn-register-sub", "ani-act", function () {
        //if (name == "" && name=="请选择") {
        //    uexWindow.alert("提示", "请选择单位类型！", "确定");
        //    return;
        //}
        if ($("#cusCompany").val() == "") {
            uexWindow.alert("提示", "请填写单位名称！", "确定");
            return;
        }
        if ($("#cusAddress").val() == "") {
            uexWindow.alert("提示", "请填写单位地址！", "确定");
            return;
        }

        //var ss=document.getElementById('TextBox4').value;
        var re = /^[1-9][0-9]{5}$/
        if ($("#cusPostcode").val() != "" && !re.test($("#cusPostcode").val())) {
            uexWindow.alert("提示", "邮政编码格式不正确！", "确定");
            return;
        }

        if ($("#cusLeader").val() == "") {
            uexWindow.alert("提示", "请填写联系人姓名！", "确定");
            return;
        }
        var filter = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
        if ($("#cusEmail").val() != "" && !filter.test($("#cusEmail").val())) {
            uexWindow.alert("提示", "邮件格式不正确！", "确定");
            return;
        }
        var code = document.getElementById("code").value;
        if (code == "" || code == "") {
            uexWindow.alert("提示", "请输入验证码！", "确定");
            return;
        }

        //向后台发送数据  
        var form = $('form');

        form.attr("action", URL + "/comm/user/registered");
        appcan.request.postForm(form, function (data) {
            if (data.indexOf("错误") > 0 || data.indexOf("失败") > 0) {
                uexWindow.alert(data);
            } else {
                appcan.locStorage.remove("sid");
                appcan.locStorage.remove("loginName");
                appcan.locStorage.remove("loginPassword");
                appcan.window.open("register_success", "register_success.html", 10);
            }
        });

    })

    appcan.button("#message", "ani-act", function () {
        var phone = $("#cusMobile")[0].value;
        if (phone == "") {
            uexWindow.alert("提示", "请填写联系方式", "确定");
            return;
        }
        var myreg = /^(((13[0-9]{1})|(15[0-9]{1})|(17[0-9]{1})|(18[0-9]{1}))+\d{8})$/;
        if (!myreg.test(phone)) {
            uexWindow.alert("提示", "请输入有效的手机号码!", "确定");
            return;
        }

        appcan.window.openToast('加载中...', '0', '5', '1');
        //向后台发送数据  
        $.ajax({
            type: "POST", //用POST方式传输  
            dataType: "text",
            headers: {
                accept: "*/*"
            },
            url: URL + '/comm/user/sendSMS',
            data: "phone=" + phone,
            error: function (XMLHttpRequest, textStatus, errorThrown) {},
            success: function (data) {
                appcan.window.closeToast();
                if (typeof data == "string") {
                    data = eval("(" + data + ")");
                }
                appcan.locStorage.setVal("sid", data.sid);
                document.getElementById("sid").value = data.sid;
                alert(data.retMessage);

                //alert(data.sid);
                //appcan.locStorage.setVal("sid", data.sid);
                //document.getElementById("sid").value = data.sid;
            }
        });
        //alert("send message");
    })
    var lv = appcan.listview({
        selector: "#cusTypeName",
        type: "thinLine",
        hasAngle: true
    });
    lv.set([{
        title: "请选择",
    }])
    lv.on("click", function (ele, obj, curEle) {
        appcan.window.open("reg_org", "register_org.html", 5);
    })
</script>

</html>