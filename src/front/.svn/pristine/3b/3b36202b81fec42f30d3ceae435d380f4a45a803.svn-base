<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">

<head>
    <title></title>
    <meta charset="utf-8">
    <meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link rel="stylesheet" href="../build/css/fonts/font-awesome.min.css">
    <link rel="stylesheet" href="../build/css/ui-box.css">
    <link rel="stylesheet" href="../build/css/ui-base.css">
    <link rel="stylesheet" href="../build/css/ui-color.css">
    <link rel="stylesheet" href="../build/css/appcan.icon.css">
    <link rel="stylesheet" href="../build/css/appcan.control.css">
    <link rel="stylesheet" href="css/infomgmt.css">
    <script src="../common/comm.js"></script>
</head>

<body class="um-vp bc-bg" ontouchstart>

    <script src="../build/js/appcan.js"></script>
    <script src="../build/js/appcan.control.js"></script>
</body>
<script>
    var vehicleData = {};
    appcan.ready(function () {
        appcan.window.subscribe("updateVehOK", function (refresh) {
            if (refresh == "0") {
                //window.location.reload();
                reload();
            }
        })

        appcan.window.subscribe("deletealert", function (alert) {
            if (alert == "true") {
                deleteVehicle();
            }
        })
        queryCusVehicle();
    });

    function reload() {
        $("body").html("");
        queryCusVehicle();
    }

    function queryCusVehicle() {
        var url = URL + "/app/cus/vehicle/queryCusVehicle";
        var paramJsonStr = "pager.pageNo=" + offset + "&pager.pageSize=" + limit;
        var func = initVehicleData;
        var dataType = "text";
        ajaxPostQuery(url, paramJsonStr, func, dataType);
        appcan.window.openToast('数据加载中...', '0', '5', '1');
    }

    function initVehicleData(data) {
        appcan.window.closeToast();
        if (typeof data == "string") {
            data = eval("(" + data + ")");
        }
        var htmlString = "";
        var vehicleArray = data.rows;
        for (var i = 0; i < vehicleArray.length; i++) {
            var vehicleId = vehicleArray[i].vehicleId;
            var vehicleCode = vehicleArray[i].vehicleCode;
            var vehicleLoad = vehicleArray[i].vehicleLoad;
            var vehicleName = vehicleArray[i].vehicleName;
            var driverName = vehicleArray[i].driverName;
            var driverMobile = vehicleArray[i].driverMobile;
            var suppercargoName = vehicleArray[i].suppercargoName;
            var suppercargoMobile = vehicleArray[i].suppercargoMobile;
            var vehicleTypeName = vehicleArray[i].vehicleTypeName;
            var vehicleType = vehicleArray[i].vehicleType;
            var stateName = vehicleArray[i].state == 1 ? '审核通过' : '审核未通过';

            var param = {
                vehicleCode: vehicleCode,
                vehicleLoad: vehicleLoad,
                vehicleName: vehicleName,
                vehicleTypeName: vehicleTypeName,
                vehicleTypeId: vehicleType
            }
            vehicleData[vehicleId] = param;

            htmlString +=
                '<div class="ub ub-ver white-bg "><div class="ub m-row umar-l umar-r mf-size1"><div class="ub ub-ac l-width">' +
                '<span class="gray-font">车牌号</span></div><div class="ub ub-ac ub-f1">' +
                vehicleCode +
                '</div></div>' +
                '<div class="ub m-row umar-l umar-r mf-size1"><div class="ub ub-ac l-width">' +
                '<span class="gray-font">载重（吨）</span>' +
                '</div><div class="ub ub-ac ub-f1">' +
                vehicleLoad +
                '</div></div>' +

                '<div class="ub m-row umar-l umar-r mf-size1"><div class="ub ub-ac l-width">' +
                '<span class="gray-font">司机</span></div><div class="ub ub-ac ub-f1">' +
                driverName +
                '</div></div>' +
                '<div class="ub m-row umar-l umar-r mf-size1"><div class="ub ub-ac l-width">' +
                '<span class="gray-font">司机电话</span></div><div class="ub ub-ac ub-f1">' +
                driverMobile +
                '</div></div>' +
                '<div class="ub m-row umar-l umar-r mf-size1"><div class="ub ub-ac l-width">' +
                '<span class="gray-font">押运员</span>' +
                '</div><div class="ub ub-ac ub-f1">' +
                suppercargoName +
                '</div></div>' +
                '<div class="ub m-row umar-l umar-r mf-size1"><div class="ub ub-ac l-width">' +
                '<span class="gray-font">押运员电话</span>' +
                '</div><div class="ub ub-ac ub-f1">' +
                suppercargoMobile +
                '</div></div>' +
                '<div class="ub m-row umar-l umar-r mf-size1"><div class="ub ub-ac l-width">' +
                '<span class="gray-font">状态</span>' +
                '</div><div class="ub ub-ac ub-f1">' +
                stateName +
                '</div></div>'

                +
                '</div>'

            if (i < vehicleArray.length) {
                htmlString += '<div class="ub ub-pe umar-l padding-a"><div class="ub ub-ac umar-r" id="">'

                    +
                    '<div id="' + vehicleId +
                    '" class="umar-l m-btn border-btn btn-delete" onclick="delVehicle(id)">删除</div></div></div>';
            }
        };

        $("body").append(htmlString);
    }

    appcan.button("#edit", "btn-act", function () {

    })
    //编辑车辆信息
    function editVehicle(id) {
        var vehicleInfo = vehicleData[id];
        appcan.locStorage.setVal("vehicleId", id);
        appcan.locStorage.setVal("vehicleInfo", vehicleInfo);
        appcan.window.open("vehicleAdd", "vehicleAdd.html", 10);
    }

    function delVehicle(id) {
        appcan.locStorage.setVal("deleId", id);
        uexWindow.evaluateScript("vehicleMgmt", 0, "openalert()");
    }

    //删除车辆信息
    function deleteVehicle() {
        var id = appcan.locStorage.getVal("deleId");
        var url = URL + "/app/cus/vehicle/delCusVehicle";
        var paramJsonStr = "vehicleId=" + id;
        var func = delVehiCallback;
        var dataType = "text";
        ajaxPostQuery(url, paramJsonStr, func, dataType);
    }

    function delVehiCallback(data) {
        if (data == "0") {
            //window.location.reload();
            reload();
        }
    }
</script>

</html>