<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">

<head>
    <title></title>
    <meta charset="utf-8">
    <meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link rel="stylesheet" href="../build/css/fonts/font-awesome.min.css">
    <link rel="stylesheet" href="../build/css/ui-box.css">
    <link rel="stylesheet" href="../build/css/ui-base.css">
    <link rel="stylesheet" href="../build/css/ui-color.css">
    <link rel="stylesheet" href="../build/css/appcan.icon.css">
    <link rel="stylesheet" href="../build/css/appcan.control.css">
    <link rel="stylesheet" href="css/manager.css">
    <script src="../common/common.js"></script>
    <style>
        .w25 {
            width: 25% !important;
            float: left;
            text-align: center;
        }

        .w50 {
            width: 50% !important;
        }

        .none {
            display: none !important;
        }

        .pt02 {
            padding-top: 0.2em;
        }

        .ellipsis {
            word-wrap: normal;
            /* for IE */
            text-overflow: ellipsis;
            white-space: nowrap;
            overflow: hidden;
        }
    </style>
</head>

<body class="um-vp bc-bg ub-ver" ontouchstart>
    <div class="ub ub-pj item-height1 sc-bg mf-size1" id="">
        <div class="umar-a" style="width: 80%;">
            <div id="empName"></div>
            <div id="orgName" class="umar-t ellipsis" style="width:98%;"></div>
        </div>
        <div class="ub uinn3" style="float:left">
            <div class="ub ub-ac ub-pc mf-size2" id="logout">
                注销
                <span id="" class="fa fa-angle-right"> </span>
            </div>
        </div>
    </div>

    <div class="gap" id=""></div>

    <div class="item-height-intention sc-bg">
        <div id="listview" class="sc-bg m-list"></div>
        <div class="padding-a1 controlBox">
            <div id="audit0" class="isA w25 none" onclick="viewDD(id)">
                <div class="ui-s-state1 state1-tbd"></div>
                <div class="mf-size2 pt02">
                    订单审核
                </div>
            </div>
            <div id="audit1" class="isB quanzi w25 none" onclick="viewDD(id)">
                <div class="ui-s-state1 state1-exchange"></div>
                <div class="mf-size2 pt02">
                    订单结算
                </div>
            </div>

            <div id="audit2" class="isC  w25 none" onclick="viewDD(id)">
                <div class="ui-s-state1 state-delivery"></div>
                <div class="mf-size2 pt02">
                    配送自提
                </div>
            </div>
            <div id="audit3" class="isC  w25 none" onclick="viewDD(id)">
                <div class="ui-s-state1 state1-pay"></div>
                <div class="mf-size2 pt02">
                    资金审核
                </div>
            </div>
        </div>

    </div>

    <div class="gap" style="position: relative;top: -1px"></div>

    <div class="ub ub-ver sc-bg" id="">
        <div id="searchOrders">
            <div id="listview" class="sc-bg m-list">
                <ul>
                    <li class="ub bc-border bc-text ub-ac lis" id="1" data-index="0">
                        <div class="lv_title ub-f1 marg-l ub ub-ver ut-m line1">
                            <div class="ub ub-ac padding-a mf-size2">业务查询</div>
                        </div>
                        <div class="tx-r sc-text ulev-1 umar-r lv_subTitle">查询单据</div>
                        <div class="fa fa-angle-right ulev2 sc-text"></div>
                    </li>
                </ul>
            </div>
            <div is="search1" class="ub ubt  bc-border ub-ac padding-a1">
                <div id="search0" class="w25" onclick="search(id)">
                    <div class="ui-s-state state-search"></div>
                    <div class="mf-size2 pt02">
                        订单查询
                    </div>
                </div>
                <div id="search1" class="w25" onclick="search(id)">
                    <div class="ui-s-state state-search"></div>
                    <div class="mf-size2 pt02">
                        结算查询
                    </div>
                </div>
                <div id="search3" class="w25" onclick="search(id)">
                    <div class="ui-s-state state-search"></div>
                    <div class="mf-size2 pt02">
                        付油通知单
                    </div>
                </div>
                <div id="search4" class="w25" onclick="search(id)">
                    <div class="ui-s-state state-search"></div>
                    <div class="mf-size2 pt02">
                        客存查询
                    </div>
                </div>

            </div>
            <div class="ub ubt  bc-border ub-ac padding-a1">

                <div id="search7" class="w25" onclick="search(id)">
                    <div class="ui-s-state state-search"></div>
                    <div class="mf-size2 pt02">
                        提货单查询
                    </div>
                </div>
                <div id="search8" class="w25" onclick="search(id)">
                    <div class="ui-s-state state-search"></div>
                    <div class="mf-size2 pt02">
                        出库单查询
                    </div>
                </div>
                <div id="search5" class="w25" onclick="search(id)">
                    <div class="ui-s-state state-table"></div>
                    <div class="mf-size2 pt02">
                        订单报表
                    </div>
                </div>
                <div id="search6" class="w25" onclick="search(id)">
                    <div class="ui-s-state state-table"></div>
                    <div class="mf-size2 pt02">
                        结算报表
                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="gap" id=""></div>

    <div class="item-height-intention sc-bg">
        <div id="others" class="sc-bg m-list"></div>
        <div class="padding-a1">
            <div id="other0" class="w25" onclick="othersFeatures(id)">
                <div class="ui-s-state1 state1-cancel"></div>
                <div class="mf-size2 pt02">
                    修改密码
                </div>
            </div>
            <div id="debug" class="w25" onclick="othersFeatures(id)">
                <div class="ui-s-state1 state-order"></div>
                <div class="mf-size2 pt02">
                    真机测试
                </div>
            </div>
        </div>

    </div>

    <script src="../build/js/appcan.js"></script>
    <script src="../build/js/appcan.control.js"></script>
    <script src="../build/js/appcan.listview.js"></script>
    <script src="../common/jquery.min.js" type="text/javascript" charset="utf-8"></script>
</body>
<script>
    var box = document.getElementById("searchOrders");
    var companyType = getVal("companyType");
    var username = getVal("username");
    var userList = getVal("userList");
    var userListArr = JSON.parse(this.userList);
    var obj = {};

    var pipei = function (val) {
        var re = new RegExp("." + val, "g");
        var isYao = /姚桢/;
        var isYSC = /营销处销售业务/;
        for (var i = 0; i < userListArr.length; i++) {
            var item = userListArr[i].roleName;
            if (re.test(item) || isYao.test(item) || isYSC.test(item)) {
                return true;
            }
        }
        return false;
    }

    // 订单审核
    obj.isA = pipei("订单审核");
    // 订单结算
    obj.isB = pipei("合资公司订单结算");
    // 配送自提审核 总部不显示
    obj.isC = pipei("配送自提审核");
    // 资金管理
    obj.isD = pipei("资金管理");
    // 订单查询，结算单查询，客存查询，提货单查询，出库单查询，付油通知单查询
    obj.isSearch = pipei("业务查询");
    // 订单报表，结算报表
    obj.isStats = pipei("小越越");
    console.log(obj);


    var noneArr = $$('.none');
    if (obj.isA || obj.isB || obj.isC || obj.isD) {
        for (var i = 0; i < noneArr.length; i++) {
            var item = noneArr[i];
            if (item.id == "audit0" && obj.isA) {
                item.classList.remove('none');
            }
            // 订单结算权限 受到权限状态控制 同时此功能全资公司不需要，只有合资公司需要；
            if (item.id == "audit1" && obj.isB) {
                item.classList.remove('none');
            }
            if (item.id == "audit2" && obj.isC) {
                item.classList.remove('none');
            }
            if (item.id == "audit3" && obj.isD) {
                item.classList.remove('none');
            }
        }
    } else {
        hide($$('.item-height-intention')[0]);
        $$('.gap')[0].remove();
    }

    if (!obj.isSearch && !obj.isStats) {
        hide(getId('searchOrders'));
        $$('.gap')[1].remove();
    } else {
        if (!obj.isSearch) {
            getId("search1").remove();
            getId("search7").classList.add('none');
            getId("search8").classList.add('none');
        }
        if (!obj.isStats) {
            getId("search5").classList.add('none');
            getId("search6").classList.add('none');
        }
    }
    // 总部用户非姚桢不可以看订单结算
    if (companyType === "总部") {
        getId("audit1").classList.add('none');
    }

    var lv_yx = appcan.listview({
        selector: "#listview",
        type: "thinLine",
        hasIcon: false,
        hasAngle: true,
        hasSubTitle: true,
        multiLine: 1,
    });

    lv_yx.set([{
        title: " <div class='ub ub-ac padding-a mf-size2'>业务操作</div>",
        subTitle: "全部订单",
        id: "1"
    }]);

    lv_yx.on("click", function (ele, obj, curEle) {
        appcan.window.open("intention", "../intention/intention.html", 10);
    });

    var others = appcan.listview({
        selector: "#others",
        type: "thinLine",
        hasIcon: false,
        hasAngle: true,
        hasSubTitle: true,
        multiLine: 1,
    });
    others.set([{
        title: " <div class='ub ub-ac padding-a mf-size2'>其他功能</div>",
        subTitle: "查看更多",
        id: "1"
    }]);

    others.on("click", function (ele, obj, curEle) {
        // appcan.window.open("intention", "../intention/intention.html", 10);
    });

    var empName = "";
    var orgName = "";
    appcan.ready(function () {
        var orgInfo = getVal("orgInfo");
        orgInfo = JSON.parse(orgInfo);
        empName = orgInfo.empName;
        orgName = orgInfo.orgName;
        getId("empName").innerHTML = empName;
        getId("orgName").innerHTML = orgName;
    });
    // 业务操作
    function viewDD(id) {
        switch (id) {
            case "audit0":
                // 审核订单
                appcan.window.open("toConfirm", "../intention/toAudit.html", 10);
                break;
                // 订单结算
            case "audit1":
                appcan.window.open("toTransferOil", "../intention/toCheckout.html", 10);
                break;
            case "audit2":
                // 配送自提
                appcan.window.open("pszt", "../intention/toPSZT.html", 10);
                break;
            case "audit3":
                // 资金审核
                appcan.window.open("pszt", "../intention/fundingreview.html", 10);
                break;
        }
    }

    // 业务查询
    function search(id) {
        switch (id) {
            case "search0":
                // 全资，合资 订单查询
                appcan.window.open("search", "../search/order.html", 10);
                break;
            case "search1":
                // 全资，合资  销售结算单查询
                appcan.window.open("cus", "../search/jiesuan.html", 10);
                break;
            case "search2":
                // 全资，合资 配送自提查
                appcan.window.open("cus", "../search/pszt.html", 10);
                break;
                // 全资 付油通知单查询
            case "search3":
                appcan.window.open("cus", "../search/fuyou.html", 10);
                break;
            case "search4":
                // 全资，合资 客存查询
                appcan.window.open("cus", "../search/kecun.html", 10);
                break;
                // 全资，合资 销售统计
            case "search5":
                appcan.window.open("search", "../search/huizong.html", 10);
                break;
                // 合资 结算统计
            case "search6":
                appcan.window.open("jiesuan_statistics", "../search/jiesuan_statistics.html", 10);
                break;
                // 提货单查询
            case "search7":
                appcan.window.open("tihuodan", "../search/tihuodan.html", 10);
                break;
                // 出库单查询
            case "search8":
                appcan.window.open("tihuodan", "../search/chukudan.html", 10);
                break;
        }
    }

    function othersFeatures(id) {

        switch (id) {
            case "other0":
                //------------------ 修改密码
                appcan.window.open("search", "changePwd.html", 10);
                break;
            case "debug":
             //------------------ 测试调试
             appcan.window.open("debug", "../test/test.html", 10);
        }
    }

    function openpage(id) {
        if (id) {
            appcan.window.alert({
                title: "提示",
                content: "该功能模块暂时未开通,敬请期待",
                buttons: ['我支持'],
                callback: function (err, data, dataType, optId) {

                    console.log(err, data, dataType, optId);
                }
            });
        }
    }


    appcan.button("#logout", "btn-act", function () {
        var url = URL + "/app/admin/loginout";
        var paramJsonStr = "";
        var func = logoutCallback;
        var dataType = "text";
        ajaxPostQuery(url, paramJsonStr, func, dataType);
        appcan.window.openToast('加载中...', '0', '5', '1');
    })

    function logoutCallback(data) {
        appcan.window.closeToast();
        if (data == "ok") {
            appcan.locStorage.remove("sid");
            appcan.locStorage.setVal("status", "out");
            uexWindow.evaluateScript("manager", 0, "openindex()");
        } else {
            oneAlert("注销账户失败，请稍后重试！")
        }
    }
</script>

</html>