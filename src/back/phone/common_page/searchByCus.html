<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">

<head>
  <title></title>
  <meta charset="utf-8">
  <meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
  <link rel="stylesheet" href="../build/css/fonts/font-awesome.min.css">
  <link rel="stylesheet" href="../build/css/ui-box.css">
  <link rel="stylesheet" href="../build/css/ui-base.css">
  <link rel="stylesheet" href="../build/css/ui-color.css">
  <link rel="stylesheet" href="../build/css/appcan.icon.css">
  <link rel="stylesheet" href="../build/css/appcan.control.css">
  <link rel="stylesheet" href="../intention/css/intention.css" />
  <style>
    #cusCompany,
    #cusCompany1,
    #cusCompany2,#oilinfoId {
      width: 7em;
      border: 0;
      outline: 0;
      -webkit-appearance: none;
      font: 1.2em;
      background-color: transparent;
    }
    #createDate1,#createDate2 {
      width: 3.6em;
      padding: 0.2em 0.6em;
    }
  </style>
</head>

<body class="pop-body" ontouchstart>

  <div class="pop-wrapper">
    <div class="pop-content">
      <form id="formData">
        <div class="pop-info">
          <label for="cusName">销售公司：</label>

          <select id="gyfgsSelect" name="gyfgs" class="mySelect" style="font-size:1em;"></select>

        </div>
        <div class="pop-info">
          <label for="cusCompany">客户名称：</label>
          <input type="text" class="mf-size0" id="cusCompany" name="cusCompany" placeholder="请输入客户名称" />
        </div>
        <div class="pop-info">
          <label for="oilinfoId">油品名称：</label>
          <select id="oilinfoIdSelect" name="oilinfoId" class="mySelect" style="font-size:1em;"></select>
        </div>
        <div class="pop-info">
          <label for="cusCompany2">订单编号：</label>
          <input type="text" class="mf-size0" id="cusCompany2" name="ordersaleCode" placeholder="请输入订单编号" />
        </div>
        <div class="pop-info">
          <label for="cusCompany2">时间：</label>
          <input class="date wry ulev-1" name="createDate1" id="createDate1" type="input" value=""> 至
          <input class="date wry ulev-1" name="createDate2" id="createDate2" type="input" value="">
        </div>
      </form>

      <div id="btn" class="ub ub-ac">
        <div id="confirmBtn" class="uinn5 ubt ubr bc-border ub ub-f1 ub-pc">
          <span class="bc-color">查询</span>
        </div>
        <div id="cancelBtn" class="uinn5 ubt bc-border ub ub-f1 ub-pc">
          <span class="bc-color">关闭</span>
        </div>
      </div>
    </div>
  </div>
</body>

<script src="../build/js/appcan.js"></script>
<script src="../build/js/appcan.control.js"></script>
<script src="../common/common.js"></script>
<script src="../common/jquery.min.js"></script>
<script src="../common/template-web.js"></script>
<script id="gyfgs" type="text/html">

  {{each list}}
  <option value={{$value.orgId}}>{{$value.orgNameEasy ||orgName}}</option>
  {{/each}}

</script>

<script id="oilinfoId" type="text/html">

  {{each list}}
  <option value={{$value.OILINFO_ID}}>{{$value.OILINFO_NAME}}</option>
  {{/each}}

</script>

<script>
  var SelectData = {
    "gyfgs": [],
    "oilList": []
  }
  var index = '';

  // 分页参数传递
  var pagerParam = {

  }
  getGYFGS();
  getOilInfo();

  appcan.ready(function () {
    appcan.initBounce();
    // 销售公司=》购油分公司
    var html1 = template('gyfgs', {
      list: SelectData.gyfgs
    })
    // 油品列表
    var oilListHtml = template('oilinfoId', {
      list: SelectData.oilList
    })

    $("#gyfgsSelect").html(html1);
    $("#oilinfoIdSelect").html(oilListHtml);
    $("#gyfgsSelect").prepend("<option value=''>请选择</option>");
    $("#oilinfoIdSelect").prepend("<option value=''>请选择</option>");
    // 绑定时间选择器
    uexControl.cbOpenDatePicker = cbOpenDatePicker;
    $("#createDate1").click(getNativityDate);
    $("#createDate2").click(getNativityDate);
  })


  appcan.button("#confirmBtn", "act-ani", function () {

    var type = appcan.locStorage.getVal("searchType");
    switch (type) {
      case "tihuodan":

        var func = showOrderCallback;
        var url = URL + "/backgrd/newBilSend/getSendAndOutStoreList";

        var baseParam = serialize(document.getElementById(
          "formData")) + "&pager.pageSize=" + pageSize;

        var paramJsonStr = baseParam + "&pager.pageNo=" + pageNo;

        pagerParam["baseParam"] = baseParam;

        pagerParam["pager.pageNo"] = 1;
        pagerParam["url"] = url;


        ajaxPostQuery(url, paramJsonStr, func, "text");
        break;
      case "chukudan":

        var func = showOrderCallback2;
        var baseParam = serialize(document.getElementById(
          "formData")) + "&pager.pageSize=" + pageSize + "&outAgoFlag=outAgoFlag";
        var paramJsonStr = baseParam + "&pager.pageNo=" + pageNo;
        var url = URL + "/backgrd/newBilSend/getSendAndOutStoreList";

        pagerParam["baseParam"] = baseParam;

        pagerParam["pager.pageNo"] = 1;
        pagerParam["url"] = url;

        ajaxPostQuery(url, paramJsonStr, func, "text");

      default:
        break;
    }

    appcan.window.openToast('加载中...', '0', '5', '1');
  })

  function showOrderCallback(data) {
    setTimeout(function () {
      closeToast();
      if (typeof data === "string" && data != '') {
        var result = JSON.parse(data);
        var rows = result.rows;
        if (rows && rows.length > 0) {
          var obj = {
            "type": "tihuodan",
            "data": rows
          }

          appcan.locStorage.setVal("searchData", JSON.stringify(obj));

          if (rows.length > pageNo) {
            pagerParam["pager.totalRows"] = result["pager.totalRows"];
            setVal("pagerParam", JSON.stringify(pagerParam));
          } else {
            appcan.locStorage.remove("pagerParam");
          }

        } else {
          appcan.locStorage.setVal("searchData", 0);
        }
      } else {
        appcan.locStorage.setVal("searchData", 0)
      }
      appcan.window.publish("search", "true");
      closepop();
    }, 1000);
  }

  function showOrderCallback2(data) {
    setTimeout(function () {
      closeToast();
      if (typeof data === "string" && data != '') {
        var result = JSON.parse(data);
        var rows = result.rows;
        if (rows && rows.length > 0) {
          var obj = {
            "type": "chukudan",
            "data": rows
          }
          appcan.locStorage.setVal("searchData", JSON.stringify(obj));

          if (rows.length > pageNo) {
            pagerParam["pager.totalRows"] = result["pager.totalRows"];
            setVal("pagerParam", JSON.stringify(pagerParam));
          } else {
            appcan.locStorage.remove("pagerParam");
          }

        } else {
          appcan.locStorage.setVal("searchData", 0);
        }
      } else {
        appcan.locStorage.setVal("searchData", 0)
      }
      appcan.window.publish("search", "true");
      closepop();
    }, 1000);
  }

  appcan.button("#cancelBtn", "act-ani", function () {
    closepop();
  })

  //关闭浮动窗口
  function closepop() {
    appcan.closePopover("searchByCus");
  }


 
</script>

</html>