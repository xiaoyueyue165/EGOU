<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">

<head>
    <title></title>
    <meta charset="utf-8">
    <meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link rel="stylesheet" href="../build/css/fonts/font-awesome.min.css">
    <link rel="stylesheet" href="../build/css/ui-box.css">
    <link rel="stylesheet" href="../build/css/ui-base.css">
    <link rel="stylesheet" href="../build/css/ui-color.css">
    <link rel="stylesheet" href="../build/css/appcan.icon.css">
    <link rel="stylesheet" href="../build/css/appcan.control.css">
    <link rel="stylesheet" type="text/css" href="../build/css/order.css" />
</head>

<body id="nodata" class="bc-bg ub-f1 tx-l umar-t content-info" ontouchstart>
    <div id="content" class="detail white-bg bc-border">
    </div>
    <div id="more"></div>

</body>
<script type="text/html" charset="utf-8" id="html">
    {{each list}}

    <div id=list{{$index}} class='list-content white-bg'>
        <div id="orderlist{{$index}}">
            <!-- 订单编号 -->
            <div class='ub ub-ac umar-l umar-r m-row3'>

                <div>
                    <span class='gray-font'>订单编号 </span>
                    <span class='AllPrice'> {{$value.noticeCode}} </span>
                </div>

            </div>
            <div class='ub ub-ac umar-a m-row3'>
                <div id='' class='ub ub-ac t-col1'>
                    <!-- 油品名称 -->
                    {{$value.oilinfoName}}
                </div>
                <!-- 油品详情 -->
                <div class='ub ub-ac ub-pc t-col2'>
                    <span class='umar-r mf-color umar-r'>
                        <span class='mf-size2'>￥</span>
                        {{if $value.oilPrice===0}} -- {{else}} {{$value.oilPrice | changeMoney}} {{/if}}
                        <span class='gray-font mf-size2'>/吨</span>
                    </span>
                    <span class='umar-l'>
                        <!-- 油品数量-->

                        x {{if $value.oilNumber
                        <0}} 0 {{else}} {{$value.oilNumber}} {{/if}} </span>
                </div>
                <!-- 配送方式 -->
                <div class='ub ub-ac  ub-pc t-col4'>
                    <span class='s-state delivery'>

                        {{if $value.extractType==0}} 自提 {{else if $value.extractType ==1}} 配送 {{/if}}

                    </span>
                </div>
            </div>

            <div class='ub ub-ac umar-l umar-r m-row3'>
                <div id='' class='col-left'>
                    <span class='gray-font'>客户名称&nbsp;&nbsp;</span>
                    <span> {{$value.cusCompany}}</span>
                </div>
                <div class='col-right'>
                    <span class='gray-font'>总金额&nbsp;&nbsp; </span>
                    <span class='mf-color AllPrice'>
                        {{if $value.oilAmot
                        <0}} 0 {{else if $value.oilAmot===0}} -- {{else}} {{$value.oilAmot | changeMoney}}
                            {{/if}} </span>
                </div>
            </div>
            <!-- 审核状态 -->
            <div class='ub ub-ac umar-l umar-r m-row3'>
                <div id='' class='col-left'>
                    <span class='gray-font'>状态&nbsp;&nbsp;</span>
                    <span>

                        {{if $value.state=='0'}} 未审核 {{else if $value.state == '1'}} 分公司审核通过{{else if $value.state == '2'}}分公司未审核通过 {{else if $value.state
                        == '3'}}总公司审核通过 {{else if $value.state == '4'}}总公司审核通过 {{/if}}

                    </span>
                </div>
                <!-- 销售单位 -->
                <div>
                    <span class='gray-font'>所属公司&nbsp;&nbsp;</span>
                    <span>
                        {{$value.orgName}}
                    </span>
                </div>

            </div>

            <!-- 创建时间 -->
            <div class='ub ub-ac umar-l umar-r m-row3'>
                <div>
                    <span class='gray-font'>创建时间 </span>
                    <span class='AllPrice'>
                        {{$value.createDate}}
                    </span>
                </div>
            </div>

        </div>
    </div>
    <div class='gap'></div>
    {{/each}}
</script>
<script src="../build/js/appcan.js"></script>
<script src="../build/js/appcan.control.js"></script>
<script src="../common/template-web.js" type="text/javascript" charset="utf-8"></script>
<script src="../common/common.js"></script>
<script src="../common/jquery.min.js"></script>

</body>
<script>
    template.defaults.imports.changeMoney = function (value) {
        return fmoney(value)
    }
    // 当所有组件准备好后执行内部回调方法
    appcan.ready(function () {

        uexWindow.setWindowScrollbarVisible('false');

        appcan.frame.setBounce(1, function (type) {
            $("#pullstatus").html("");
        }, function (type) {
            $("#pullstatus").html("");
        }, function (type) {
            $("#pullstatus").html("松手了,产生事件了,开始更新数据！");
            // 下拉事件发生
            appcan.frame.resetBounce(1);
            // 当前总条数
            var num = Number(pageNo) * limit;

            $("#pullstatus").html("");
            // alert("totalRows=" + totalRows)

            if (Number(totalRows) <= num) {
                appcan.window.openToast({
                    msg: '没有更多',
                    duration: 1000,
                    position: 5,
                    type: 0
                });
                return;
            }

            newPageNo = Number(pageNo) + 1;

            alert('准备加载第' + newPageNo + '页')

            Orders.queryMentOilOrder(newPageNo);
        });
        mentionOil.init();

    });
    var mentionOil = {
        init: function () {
            var yue = this;
            yue.queryMentOilOrder();
        },
        queryMentOilOrder: function (newPageNo) {
            var pageNo = newPageNo ? newPageNo : 1;
            var orgId = appcan.locStorage.getVal("orgId")
            var yue = this;
            var paramJsonStr = "&pager.pageNo=" + pageNo + "&pager.pageSize=" + pageSize;
            var func = yue.showOrderCallback.bind(yue);
            var url = null;
            var companyType = appcan.locStorage.getVal("companyType");
            if (companyType == '全资' || companyType == '总部') {
                url = "/app/oil/statementnotice/selectStatementByERP"
            } else if (companyType == '合资') {
                url = "/app/oil/send/selectSendList"
            } else {
                console.log('并非全资，合资，总公司客户')
                return;
            }

            ajaxPostQuery(URL + url, paramJsonStr, func, "text");
            appcan.window.openToast('加载中...', '0', '5', '1');
        },
        showOrderCallback: function (data) {
            appcan.window.closeToast();

            if (typeof (data) === 'string') {
                var data = JSON.parse(data);
            }

            var totalCount = data.rows;

            if (totalCount.length == 0) {
                nodata('listdetail', '您没有符合条件的付油通知单')
                return;
            } else {
                var html = template('html', {
                    list: data.rows
                })

                $('#content').append(html);
                document.querySelector("#content .gap:last-child").remove();

                loadMore.init({
                    ele: "more",
                    data: totalCount,
                    totalNum: data["pager.totalRows"],
                    limit: 15,
                    clickFn: func2
                });

            }
        }
    }

    function func2(current_page, max_page, totalNum) {
        console.log(arguments)
        var y = this;
        console.log(this);
        $('#loadMore').remove();
        alert("正在加载第" + current_page + "页， 共" + max_page + "页 " + totalNum + "条数据")
        var y = this;
        mentionOil.queryMentOilOrder(current_page);
        appcan.window.openToast('数据加载中...', '0', '5', '1');
    }


    function BtnClick(noticeSubId) {
        appcan.locStorage.setVal("orderId", noticeSubId);
        appcan.window.open("detail", "mentionOil_detail.html", 10);
    }
</script>

</html>