<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">

<head>
    <title></title>
    <meta charset="utf-8">
    <meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link rel="stylesheet" href="../build/css/fonts/font-awesome.min.css">
    <link rel="stylesheet" href="../build/css/ui-box.css">
    <link rel="stylesheet" href="../build/css/ui-base.css">
    <link rel="stylesheet" href="../build/css/ui-color.css">
    <link rel="stylesheet" href="../build/css/appcan.icon.css">
    <link rel="stylesheet" href="../build/css/appcan.control.css">
    <link rel="stylesheet" href="css/notice.css">
</head>

<body class="um-vp bc-bg" ontouchstart>
    <div id="" class="ub-f1 tx-l content-info">
        <div id="titlebar" class="ub title-bar gray-font uhide">
            <div id="" class="ub ub-ac ub-pc col1">
                付油通知单号
            </div>
            <div id="" class="ub ub-ac ub-pc col2">
                油品品号
            </div>
            <div id="" class="ub ub-ac ub-pc col3">
                未出库
            </div>
            <div id="" class="ub ub-ac ub-pc col4">
                状态
            </div>
        </div>

        <div id="" class="listbox">
            <div id="listdetail" class="detail bc-border white-bg"></div>
        </div>
    </div>
    <div style="height:3em"></div>
    <div class="" id="pullstatus"></div>

    <script src="../build/js/appcan.js"></script>
    <script src="../build/js/appcan.control.js"></script>
    <script src="../common/common.js"></script>
    <script src="../common/jquery.min.js"></script>
</body>
<script>
    var totalRows = 0;
    appcan.ready(function () {
        appcan.frame.setBounce(1, function (type) {
            $("#pullstatus").html("");
        }, function (type) {
            $("#pullstatus").html("");
        }, function (type) {
            $("#pullstatus").html("");
            appcan.frame.resetBounce(1);
            var num = Number(pageNo) * limit;
            $("#pullstatus" + type).html("");
            if (Number(totalRows) <= num) {
                appcan.window.openToast({
                    msg: '无更多信息',
                    duration: 1000,
                    position: 5,
                    type: 0
                });
                return;
            }
            pageNo = Number(pageNo) + 1;
            getNotice_close();
        });
        getNotice_close();
    })

    function getNotice_close() {
        var url = URL + "/app/backgrd/bill/getNotice";
        var paramJsonStr = "state=1&pageNo=" + pageNo + "&pageSize=" + pageSize;
        var func = getNoticeCallBack;
        var dataType = "text";
        ajaxPostQuery(url, paramJsonStr, func, dataType);
        appcan.window.openToast('加载中...', '0', '5', '1');
    }

    function getNoticeCallBack(data) {
        appcan.window.closeToast();
        if (typeof data == "string") {
            data = eval("(" + data + ")");
        }
        totalRows = data.totalRows;
        var orderList = data.list;
        var listHtml = "";
        if (orderList.length > 0) {
            $("#titlebar").removeClass("uhide");
            $("body").removeClass("white-bg");
            $("body").addClass("bc-bg");
        } else {
            $("body").removeClass("bc-bg");
            $("body").addClass("white-bg");
            $("#listdetail").append(noDataMsg("暂无数据"));
        }
        for (var i = 0; i < orderList.length; i++) {
            var evaluateState = orderList[i].evaluateState;
            if (evaluateState == 0) {
                evaluateState = "<div id=''><span class=''>待评价</span></div>";
            } else {
                evaluateState = "<div id='" + orderList[i]["orderId"] +
                    "' onclick='viewEvaluate(id)'><span class='y-font'>查看评价</span></div>"
            }
            var orgTitle = "<span class=''>" + orderList[i].cusCompany + "</span><span class='inline-block m-border1'>" +
                orderList[i].cusGradeName + "</span>";
            var actStr = "<div><span class='mf-color'>" + orderList[i].ordersaleCode + "</span></div>" + evaluateState;


            listHtml = "<div id='list" + orderList[i]["orderId"] + "' class='list-content white-bg'><div id='" + i +
                "' class='ub ub-ac ub-pj m-row3'>" + actStr + "</div><div id='orderInfo" + i +
                "' class='ub ub-ac ub-pj m-row3'><div id='info" + i + "' class='ub ub-ac'><div class='ub ub-ac'>" +
                orgTitle + "</div></div></div></div>"
            var noticeSub = orderList[i].noticeSub;
            for (var j = 0; j < noticeSub.length; j++) {
                var oilinfoName = noticeSub[j].oilinfoName;
                var extractType = noticeSub[j].extractType;
                var oilNumber = noticeSub[j].oilNumber;
                var completeNum = noticeSub[j].completeNum;
                var num = (oilNumber - completeNum).toFixed(2);

                if (extractType == 0) {
                    extractType = "配送";
                } else {
                    extractType = "自提";
                }

                listHtml += "<div id='list" + i +
                    "' class='list-content white-bg'><div id='' class='ub ub-ac umar-l umar-r m-row item-row'><div id='' class='ub ub-ac ub-pc col1'>" +
                    noticeSub[j].noticeCode + "</div><div id='' class='ub ub-ac ub-pc col2'>" +
                    oilinfoName + "</div><div id='' class='ub ub-ac ub-pc col3'>" +
                    num + "</div><div id='' class='ub ub-ac ub-pc col4'>" +
                    extractType + "</div></div></div>";
            }

            if (i < orderList.length - 1) {
                listHtml += "<div class='gap'></div>";
            }
            $("#listdetail").append(listHtml);
            $("#list" + orderList[i]["orderId"]).animate({
                opacity: 1
            }, i * 500); //这句的作用是使DIV缓慢显示
            $("#list" + i).animate({
                opacity: 1
            }, i * 500); //这句的作用是使DIV缓慢显示
        }
    }

    function viewEvaluate(id) {
        appcan.locStorage.setVal("eva_orderId", id);
        appcan.window.open("viewEvalute", "viewEvaluate.html", 10);
    }
</script>

</html>