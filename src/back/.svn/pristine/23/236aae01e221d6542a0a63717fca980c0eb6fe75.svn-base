<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">
    <head>
        <title></title>
        <meta charset="utf-8">
        <meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <link rel="stylesheet" href="../build/css/fonts/font-awesome.min.css">
        <link rel="stylesheet" href="../build/css/ui-box.css">
        <link rel="stylesheet" href="../build/css/ui-base.css">
        <link rel="stylesheet" href="../build/css/ui-color.css">
        <link rel="stylesheet" href="../build/css/appcan.icon.css">
        <link rel="stylesheet" href="../build/css/appcan.control.css">
        <link rel="stylesheet" href="./css/order.css">
    </head>
    <body class="um-vp white-bg" ontouchstart>

        <div id="" class="listbox">
            <div id="listdetail" class="detail white-bg bc-border"></div>
        </div>
        <div class="" id="pullstatus"></div>

        <script src="../js/appcan.js"></script>
        <script src="../js/appcan.control.js"></script>
        <script src="../common/common.js"></script>
        <script type="text/javascript" charset="utf-8" src="../common/template-web.js"></script>
        <script src="../common/jquery.min.js"></script>
    </body>

    <script id="Allorder_list" type="text/html">

        {{each list}}

        <div id="list{{$index}}" class='list-content white-bg' ><div id='orderlist" + i + "'>

        <div id='' class='ub ub-ac umar-a m-row3'>

        <span class="gray-font ulev0">
        付油通知单编号
        </span><span id="ordersaleCode">{{$value.noticeCode}}</span>
        </div>

        <div id='' class='ub ub-ac umar-a m-row3'>

        <div id='' class='ub ub-ac t-col1'>
        <!-- 油品名称 -->

        {{$value.oilinfoName}}

        <input type="hidden" name="orderId" class="orderId" value="{{$value.orderId}}" />

        </div><div id='' class='ub ub-ac ub-pc t-col2'><span class='umar-r mf-color umar-r'><span class='mf-size2'>￥</span>
        <!-- 油品价格 -->

        {{$value.oilPrice}}

        <span class='gray-font mf-size2'>/吨</span></span><span class='umar-l'>
        <!-- 油品数量-->

        x

        
          {{if $value.oilNumber <0}}
        0
        {{else}}
        {{$value.oilNumber}}
        {{/if}}

        </span></div></div>

        <div id='pay' class='ub ub-ac umar-l umar-r m-row3'><div id='total' class=''><span class='gray-font'>总金额&nbsp;&nbsp;

        </span><span class='mf-color AllPrice'>
       
        {{if $value.oilAmot <0}}
        0
        {{else}}
        {{$value.oilAmot}}
        {{/if}}
        </span></div>

        </div>

        <div></div> <div id="position{{$index}}">

        </div>
        <div class='gap' id='idx'+{{$index}}></div>

        </div></div>

        {{/each}}
    </script>
    <script>
        var listData = {},
            sumPrice = 0.00,
            listNum = 0,
            totalRows = 0;
        appcan.ready(function() {
            appcan.frame.setBounce(1, function(type) {
                $("#pullstatus").html("");
            }, function(type) {
                $("#pullstatus").html("");
            }, function(type) {
                $("#pullstatus").html("");
                appcan.frame.resetBounce(1);
                var num = Number(pageNo) * limit;
                $("#pullstatus" + type).html("");
                if (Number(totalRows) <= num) {
                    appcan.window.openToast({
                        msg : '无更多信息',
                        duration : 1000,
                        position : 5,
                        type : 0
                    });
                    return;
                }
                pageNo = Number(pageNo) + 1;
                getNoOkOrder();
            });
            getNoOkOrder();
        });
        //获取数据
        function getNoOkOrder() {
            var url = URL + "/app/backgrd/billSend/queryOrderPointNoticeCode",
                oilinfoId = appcan.locStorage.getVal('oilinfoId'),

                applyNum = appcan.locStorage.getVal('applyNum'),

                paramJsonStr = "&pageNo=" + pageNo + "&pageSize=" + pageSize + "&oilinfoId=" + oilinfoId + "&applyNum=" + applyNum,
                func =
                getNoOkOrderCallback,
                dataType = "text";
            ajaxPostQuery(url, paramJsonStr, func, dataType);
            appcan.window.openToast('加载中...', '0', '5', '1');
        }

        //展示数据
        function getNoOkOrderCallback(data) {
            appcan.window.closeToast();
            var data = JSON.parse(data);
            var totalCount = data.length;
            listNum = totalCount;
            listData = data.rows;

            if (data.length == 0) {
                var listhtml = "<div id='time' class='ub ub-pc' style='margin: 0.8em 0;'>" + "<span class='mf-size2 time'>您没有符合条件的付邮通知单!</span>" + "</div>";
                // $("#fuyou").html("");
                $("#listdetail").append(listhtml);
                return;
            }
            //
            var html = template('Allorder_list', {
                list : data
            })

            $('#listdetail').html(html)
            var orderList = data;
            var listHtml = "";
            var sumprice = 0.00;

            for (var i = 0; i < orderList.length; i++) {

                var orderId = orderList[i].orderId;

                var appendHtml = "<div id='" + orderList[i]["orderId"] + "' class='ub ub-ac ub-pe m-row4'><span class='y-font umar-l' onclick='confirmIntention(id,\"" + orderList[i].noticeCode + "\")'>确认</span></div>";

                $("#position" + i)[0].innerHTML = appendHtml;

            }

        }

        //确认审核(单)
        function confirmIntention(id, noticeCode) {
            //分公司确认
  var orderId = appcan.locStorage.getVal('orderId'),
         url = URL + "/app/backgrd/billSend/editOrderAddNoticeCode",

                paramJsonStr = "&orderId=" + orderId + "&noticeCode=" + noticeCode,
                func =
                pushOrderCallback,
                dataType = "text";
            ajaxPostQuery(url, paramJsonStr, func, dataType);
            appcan.window.openToast('加载中...', '0', '5', '1');

        }

        function pushOrderCallback(data) {
            appcan.window.closeToast();
            var data = JSON.parse(data);
            if (data == '1') {
              
                
              uexWindow.alert("提示", "配送申请提交成功","确定");
                uexWindow.evaluateScript("orderlist", 0, "closePage()");
            } else {
                uexWindow.alert("提示", "选择付油单号提交失败！", "确定");
            }

        }

    </script>
</html>
