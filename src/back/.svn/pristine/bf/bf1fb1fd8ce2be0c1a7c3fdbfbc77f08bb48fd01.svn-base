<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">

<head>
  <title></title>
  <meta charset="utf-8">
  <meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
  <link rel="stylesheet" href="../build/css/fonts/font-awesome.min.css">
  <link rel="stylesheet" href="../build/css/ui-box.css">
  <link rel="stylesheet" href="../build/css/ui-base.css">
  <link rel="stylesheet" href="../build/css/ui-color.css">
  <link rel="stylesheet" href="../build/css/appcan.icon.css">
  <link rel="stylesheet" href="../build/css/appcan.control.css">
  <link rel="stylesheet" href="../intention/css/intention.css">
</head>

<body class="um-vp white-bg" ontouchstart>

  <div id="" class="listbox">
    <div id="listdetail" class="detail white-bg bc-border"></div>
  </div>
  <div class="" id="pullstatus"></div>

  <script src="../build/js/appcan.js"></script>
  <script src="../build/js/appcan.control.js"></script>
  <script src="../common/common.js"></script>
  <script type="text/javascript" charset="utf-8" src="../common/template-web.js"></script>
  <script src="../common/jquery.min.js"></script>
</body>

<script id="Allorder_list" type="text/html">

  {{each list}}

  <div id="list{{$index}}" class='list-content white-bg'>
    <div id='orderlist" + i + "'>
      <div id='pay' class='ub ub-ac umar-l umar-r m-row3'>
        <div id='' class='col-left'>
          <span class='gray-font'>记账时间&nbsp;&nbsp;</span>
          <span>
            {{$value.empName}}
          </span>
        </div>
        <div id='total' class='col-right'>
          <span class='gray-font'>客户名称&nbsp;&nbsp;

          </span>
          <span class='mf-color AllPrice'>
            {{$value.oilAmot}}
          </span>
        </div>

      </div>
      <div id='pay' class='ub ub-ac umar-l umar-r m-row3'>
        <div id='' class='col-left'>
          <span class='gray-font'>收款单位&nbsp;&nbsp;</span>
          <span>

            {{if $value.state=='0'}} 未审核 {{else if $value.state == '1'}} 分公司审核通过{{else if $value.state == '2'}}分公司审核未通过 {{else if $value.state
            == '3'}}总公司审核通过 {{else if $value.state == '4'}}总公司审核未通过 {{/if}}

          </span>
        </div>

        <div id='total' class='col-right'>

          <span class='gray-font'>订单编号&nbsp;&nbsp;</span>
          <span>
            {{$value.empOrgName}}
          </span>

        </div>
      </div>

      <div id='pay' class='ub ub-ac umar-l umar-r m-row3'>
        <div id='' class='col-left'>
          <span class='gray-font'>业务流水号&nbsp;&nbsp;</span>
          <span>

            {{if $value.state=='0'}} 未审核 {{else if $value.state == '1'}} 分公司审核通过{{else if $value.state == '2'}}分公司审核未通过 {{else if $value.state
            == '3'}}总公司审核通过 {{else if $value.state == '4'}}总公司审核未通过 {{/if}}

          </span>
        </div>

        <div id='total' class='col-right'>

          <span class='gray-font'>资金流向&nbsp;&nbsp;</span>
          <span>
            {{$value.empOrgName}}
          </span>

        </div>
      </div>
      <div id='pay' class='ub ub-ac umar-l umar-r m-row3'>
        <div id='' class='col-left'>
          <span class='gray-font'>收流动金额&nbsp;&nbsp;</span>
          <span>

            {{if $value.state=='0'}} 未审核 {{else if $value.state == '1'}} 分公司审核通过{{else if $value.state == '2'}}分公司审核未通过 {{else if $value.state
            == '3'}}总公司审核通过 {{else if $value.state == '4'}}总公司审核未通过 {{/if}}

          </span>
        </div>

        <div id='total' class='col-right'>

          <span class='gray-font'>账户可用余额&nbsp;&nbsp;</span>
          <span>
            {{$value.empOrgName}}
          </span>

        </div>
      </div>

      <!-- 创建时间 -->
      <div id='company' class='ub ub-ac umar-l umar-r m-row3'>
        <div id='' class=''>
          <span class='gray-font'>审核状态 </span>
          <span class='AllPrice'>
            {{$value.createDate}}
          </span>

        </div>

      </div>
      <div <div id="position{{$index}}">
        <div id='" + orderList[i]["orderId"] + "' class='ub ub-ac ub-pe m-row4'>
          <span class='y-font umar-l' onclick='failIntention(id,\"" + orderList[i].oilAmot + "\",\"" + orderList[i].cusId + "\",\"" + orderList[i].gyfgs + "\",\"" + orderList[i].orderId + "\")'>通过</span>
          <span class='y-font umar-l' onclick='confirmIntention(id,\"" + orderList[i].oilAmot + "\",\"" + orderList[i].cusId + "\",\"" + orderList[i].gyfgs + "\",\"" + orderList[i].orderId + "\")'>不通过</span>
        </div>

      </div>
      <div class='gap' id='idx' +{{$index}}></div>

    </div>
  </div>

  {{/each}}
</script>
<script>
  getNoOkOrder();
  //获取数据
  function getNoOkOrder() {
    var url = URL + "/app/oil/order/queryOrderList";
    var paramJsonStr = "&pageNo=" + pageNo + "&pageSize=" + pageSize;
    var func = getNoOkOrderCallback;
    var dataType = "text";
    ajaxPostQuery(url, paramJsonStr, func, dataType);
    appcan.window.openToast('加载中...', '0', '5', '1');
  }

  //展示数据
  function getNoOkOrderCallback(data) {
    appcan.window.closeToast();
    var data = JSON.parse(data);
    var totalCount = data.rows;
    listNum = totalCount.length;
    listData = data.rows;

    if (data.length == 0) {
      var listhtml = "<div id='time' class='ub ub-pc' style='margin: 0.8em 0;'>" +
        "<span class='mf-size2 time'>您没有符合条件的付邮通知单!</span>" + "</div>";
      // $("#fuyou").html("");
      $("#listdetail").append(listhtml);
      return;
    }
    //
    var html = template('Allorder_list', {
      list: data.rows
    })

    $('#listdetail').html(html)
    document.querySelector(" .list-content:last-child .gap").style.height = "5em"
  }

  //确认审核(单，多)
  function confirmIntention(id, oilAmot, cusId, gyfgs, orderId) {

    // 分公司直接审批
    var url = URL + "/app/oil/order/updateBatchOrder",
      stateStr = appcan.locStorage.getVal('orgType'),

      state = stateStr == '1' ? 1 : 2,

      //分 1 总2
      paramJsonStr = "orderIds=" + orderId + "&state=" + state,
      func =
      okOrderCallback,
      dataType = "text";
    ajaxPostQuery(url, paramJsonStr, func, dataType);
    appcan.window.openToast('审批中...', '0', '5', '1');

  }

  //总/合资公司审核回调
  function okOrderCallback(data) {
    $("#listdetail").html("");

    appcan.window.closeToast();
    data = eval("(" + data + ")");
    uexWindow.alert("提示", "刷新表单中！", "确定");
    // appcan.window.openToast({
    // msg : '您的意向单已提交，客户经理会尽快为您处理!<br>您可以到“我的意向单-处理中”中查看您的意向单。',
    // duration : 1000,
    // position : 5,
    // type : 0
    // });
    //
    // reload();
    //重新加载页面
    getNoOkOrder();

  }
</script>

</html>