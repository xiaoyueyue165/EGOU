<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">

<head>
  <title></title>
  <meta charset="utf-8">
  <meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
  <link rel="stylesheet" href="../build/css/fonts/font-awesome.min.css">
  <link rel="stylesheet" href="../build/css/ui-box.css">
  <link rel="stylesheet" href="../build/css/ui-base.css">
  <link rel="stylesheet" href="../build/css/ui-color.css">
  <link rel="stylesheet" href="../build/css/appcan.icon.css">
  <link rel="stylesheet" href="../build/css/appcan.control.css">
  <link rel="stylesheet" href="../intention/css/intention.css" />
  <style>
    #cusCompany {
      width: 6.65em;
      border: 0;
      outline: 0;
      -webkit-appearance: none;
      font: 1.2em;
      background-color: transparent;
    }
  </style>
</head>

<body class="pop-body" ontouchstart>

  <div class="pop-wrapper">
    <div class="pop-content">
      <form id="formData">
        <input type="hidden" id="detailFlag" name="detailFlag" value="detailFlag" />
        <div class="pop-info">
          <label for="cusName">提货方式：</label>
          <select id="extractType" name="extractType" class="mySelect" style="font-size:1em;">
            <option value="">请选择</option>
            <option value="0">配送</option>
            <option value="1">自提</option>
          </select>

        </div>
        <div class="pop-info">
          <label for="cusName">运输方式：</label>
          <select id="ysfsSelect" name="ysfs" class="mySelect" style="font-size:1em;"></select>

        </div>
        <div class="pop-info">
          <label for="cusName">客户名称：</label>
          <input type="text" class="mf-size0" id="cusCompany" name="cusCompany" placeholder="请输入客户名称" />
        </div>
        <div class="pop-info">
          <label for="cusName">油库地点：</label>
          <select id="ykddSelect" name="ykdd" class="mySelect" style="font-size:1em;"></select>
        </div>
      </form>

      <div id="btn" class="ub ub-ac">
        <div id="confirmBtn" class="uinn5 ubt ubr bc-border ub ub-f1 ub-pc">
          <span class="bc-color">查询</span>
        </div>
        <div id="cancelBtn" class="uinn5 ubt bc-border ub ub-f1 ub-pc">
          <span class="bc-color">关闭</span>
        </div>
      </div>
    </div>
  </div>
</body>

<script src="../build/js/appcan.js"></script>
<script src="../build/js/appcan.control.js"></script>
<script src="../common/common.js"></script>
<script src="../common/jquery.min.js"></script>
<script src="../common/template-web.js"></script>
<script id="ysfs" type="text/html">

  {{each list}}
  <option value={{$value.dicId}}>{{$value.dicName}}</option>
  {{/each}}

</script>
<script id="ykdd" type="text/html">

  {{each list}}
  <option value={{$value.oildepotId}}>{{$value.depotName}}</option>
  {{/each}}

</script>
<script>
  var SelectData = {
    "ysfs": [],
    "ykdd": []
  }
  getYSFS();
  getYK();
  appcan.ready(function () {
    appcan.initBounce();
    // 运输方式
    var html1 = template('ysfs', {
      list: SelectData.ysfs
    })

    $("#ysfsSelect").html(html1);
    $("#ysfsSelect").prepend("<option value=''>请选择</option>");

    // 油库地点
    var html2 = template('ykdd', {
      list: SelectData.ykdd
    })

    $("#ykddSelect").html(html2);
    $("#ykddSelect").prepend("<option value=''>请选择</option>");
  })

  appcan.button("#confirmBtn", "act-ani", function () {

    var paramJsonStr = serialize(document.getElementById("formData")) + "&oilinfoId=" + getVal("OILINFO_ID");
    var func = showOrderCallback;

    ajaxPostQuery(URL + "/app/oil/kecun/queryKecunList", paramJsonStr, func, "text");
    appcan.window.openToast('加载中...', '0', '5', '1');
  })

  function showOrderCallback(data) {
    setTimeout(function () {
      closeToast();
      if (typeof data === "string" && data != '') {
        var result = JSON.parse(data);
        var rows = result.rows;
        if (rows && rows.length > 0) {
          var obj = {
            "type": "kecun_detail",
            "data": rows
          }

          appcan.locStorage.setVal("searchData", obj)

        } else {
          appcan.locStorage.setVal("searchData", 0);
        }
      } else {
        appcan.locStorage.setVal("searchData", 0)
      }
      appcan.window.publish("search", "true");
      closepop();
    }, 1000);
  }

  function getYSFS() {
    var func = YSFS;
    syncLoadData(URL + "/backgrd/bilInstorePlan/queryYsfsList", null, func);
  }

  function getYK() {
    var func = YKDD;
    syncLoadData(URL + "/backgrd/bilInstorePlan/queryOilDepotInfoList", null, func);
  }

  function YSFS(data) {
    SelectData.ysfs = JSON.parse(data);
  }

  function YKDD(data) {
    SelectData.ykdd = JSON.parse(data);
  }

  appcan.button("#cancelBtn", "act-ani", function () {
    closepop();
  })

  //关闭浮动窗口
  function closepop() {
    appcan.closePopover("searchForKecun");
  }
</script>

</html>