<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">

<head>
    <title></title>
    <meta charset="utf-8">
    <meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link rel="stylesheet" href="../build/css/fonts/font-awesome.min.css">
    <link rel="stylesheet" href="../build/css/ui-box.css">
    <link rel="stylesheet" href="../build/css/ui-base.css">
    <link rel="stylesheet" href="../build/css/ui-color.css">
    <link rel="stylesheet" href="../build/css/appcan.icon.css">
    <link rel="stylesheet" href="../build/css/appcan.control.css">
    <link rel="stylesheet" href="css/delivery.css">
</head>

<body class="um-vp white-bg" ontouchstart>

    <div id="" class="listbox mf-size1 umar-r">
        <div id="listdetail" class="detail bc-border"></div>
    </div>

    <script src="../build/js/appcan.js"></script>
    <script src="../build/js/appcan.control.js"></script>
    <script src="../build/js/appcan.tab.js"></script>
    <script src="../common/common.js"></script>
    <script src="../common/jquery.min.js"></script>
</body>
<script>
    var listdata = [];
    appcan.ready(function () {
        initDelivery();
    });

    function initDelivery() {
        var sendDate = GetDateStr(15);
        var url = URL + "/app/backgrd/delivery/selectBillDelivery";
        var paramJsonStr = "limit=" + limit + "&offset=" + offset + "&extractType=0&sendDate=" + sendDate;
        var func = selectBillDeliveryCallback;
        var dataType = "text";
        ajaxPostQuery(url, paramJsonStr, func, dataType);
        appcan.window.openToast('加载中...', '0', '5', '1');
    }

    function selectBillDeliveryCallback(data) {
        appcan.window.closeToast();
        if (typeof data == "string") {
            data = eval("(" + data + ")");
        }

        if (data.length > 0) {
            cusNoticeArray = data;
            if (cusNoticeArray.length > 0) {
                for (var i = 0; i < cusNoticeArray.length; i++) {
                    var listCellData = cusNoticeArray[i];
                    //状态：0待处理 1处理中 2已出库
                    var state = listCellData.STATE;
                    //客户名称
                    var cusName = listCellData.CUS_COMPANY;
                    //付油通知单号
                    var noticeCode = listCellData.NOTICE_CODE;
                    //油品信息
                    var oilInfoName = listCellData.OILINFO_NAME;
                    //driverId位-1的时候为自提
                    var driverId = listCellData.DRIVER_ID;
                    var quyouGasstationName = listCellData.quyouGasstationName;
                    if (typeof (quyouGasstationName) == "undefined") {
                        quyouGasstationName = "";
                    } else {
                        quyouGasstationName = '<span class="umar-l inline-block site">' + quyouGasstationName +
                            '</span>';
                    }

                    //配送时间段
                    var timeInterval = listCellData.TIME_INTERVAL;
                    //提油时间
                    var sendDate = listCellData.SEND_DATE;
                    var sendRealDate = "";
                    if (typeof (sendDate) != "undefined") {
                        sendRealDate = sendDate.substring(0, 10) + " " + timeInterval;
                    }
                    //出库时间
                    var outstoreTime = listCellData.OUTSTORE_TIME;
                    console.info(outstoreTime);
                    if (typeof (outstoreTime) != "undefined") {
                        outstoreTime = outstoreTime.substring(0, 10);
                    }
                    //配送or取油数量
                    var applyNum = listCellData.APPLY_NUM;
                    //备注
                    var remark = listCellData.REMARK;

                    var peisongTitle = "";
                    if (driverId == -1) {
                        peisongTitle = "配送时间";
                    } else {
                        peisongTitle = "提油时间";
                    }
                    var complete = "";
                    if (state == 2) {
                        complete = "complete";
                        peisongTitle = "出库时间";
                        sendRealDate = outstoreTime;
                    }

                    if (state != 5) {
                        var stateHtml = '<div class="ub umar-t umar-l">';

                        if (state == 0) {
                            stateHtml += "<span class='m-act2 mf-size2 red-bg'>待处理</span>";
                        } else　
                            if (state == 1) {
                                stateHtml += "<span class='m-act2 mf-size2 green-bg'>处理中</span>";
                            } else　
                                if (state == 2) {
                                    stateHtml += "<span class='m-act2 mf-size2 green-bg'>已出库</span>";
                                } else　
                                    if (state == 3) {
                                        stateHtml += "<span class='m-act2 mf-size2 yellow-bg'>已签收</span>";
                                    } else　
                                        if (state == 5) {
                                            stateHtml += "<span class='m-act2 mf-size2 black-bg'>已取消</span>";
                                        } else {

                                        }
                        stateHtml += '</div>';

                        var cusHtml = '<div class="ub m-row">' +
                            '<div class="ub ub-ac label-width umar-l">' +
                            '<span class = "gray-font">客户名称</span>' +
                            '</div><div class="ub ub-ac ub-f1 umar-r"><span class="">' +
                            cusName + '</span></div></div>';
                        var fyHtml = '<div class="ub m-row">' +
                            '<div class="ub ub-ac label-width umar-l">' +
                            '<span class = "gray-font">付油通知单号</span>' +
                            '</div><div class="ub ub-ac ub-f1 umar-r"><span class="mf-color">' +
                            noticeCode + '</span>';
                        if (driverId == -1) {
                            fyHtml = fyHtml + '</div></div>';
                        } else {
                            fyHtml = fyHtml + quyouGasstationName + '</div></div>';
                        }

                        var oilInfoHtml = '<div class="ub m-row">' +
                            '<div class="ub ub-ac label-width umar-l">' +
                            '<span class="gray-font">油品品号</span></div><div class="ub ub-ac ub-f1">' +
                            oilInfoName + '</div><div class="ub ub-ac"><span class="mf-size2">' +
                            applyNum + '&nbsp;吨</span></div></div>';

                        var address = '<div class="ub m-row">' +
                            '<div class="ub ub-ac label-width umar-l">' +
                            '<span class="gray-font">配送地址</span></div><div class="ub ub-ac ub-f1">' +
                            data[i].CUS_PROVINCE + data[i].CUS_CITY + data[i].CUS_AREA + data[i].GASSTATION_ADDRESS +
                            '</span></div></div>';


                        var timeHtml = '<div class="ub m-row  no-border-b">' +
                            '<div class="ub ub-ac label-width umar-l">' +
                            '<span class="gray-font">' +
                            peisongTitle + '</span></div><div class="ub ub-ac">' +
                            sendRealDate +
                            '</div></div></div>';

                        var gapHtml = '<div class="gap"></div>';

                        var htmlString = stateHtml + cusHtml + fyHtml + oilInfoHtml + address + timeHtml;
                        if (i < cusNoticeArray.length - 1) {
                            htmlString = htmlString + gapHtml;
                        }
                        $("#listdetail").css("opacity", "0"); //这句加在append前
                        $("#listdetail").append(htmlString);
                        $("#listdetail").animate({
                            opacity: 1
                        }, 500); //这句的作用是使DIV缓慢显示
                    }

                }
            }
        } else {
            $("#listdetail").append(noDataMsg("暂无数据"));
        }
    }

    var yesNo = 0;
    //全选
    appcan.button("#checkall", "ani-act", function () {
        if ($("#checkall")[0].className == "m-check") {
            $("#checkall")[0].className = "m-check m-check-active";
            for (var i = 0; i < listdata.length; i++) {
                $("#check" + i)[0].className = "m-check m-check-active";
                if ($("#price" + i)[0]) {
                    var p = $("#price" + i)[0].innerHTML.substring(1, $("#price" + i)[0].innerHTML.length);
                }
            }
        } else {
            $("#checkall")[0].className = "m-check";
            for (var i = 0; i < listdata.length; i++) {
                $("#check" + i)[0].className = "m-check";
            }
        }
        yesNo = 0;
    })

    //列表中单选
    function cellbtnClick(id) {
        var index = id.substring(id.length - 1, id.length);
        if ($("#check" + index)[0].className == "m-check") {
            $("#check" + index)[0].className = "m-check m-check-active";
            yesNo++;
        } else {
            $("#check" + index)[0].className = "m-check";
            yesNo--;
        }
        if (yesNo == listdata.length) {
            $("#checkall")[0].className = "m-check m-check-active";
        } else {
            $("#checkall")[0].className = "m-check";
        }
    }

    function GetDateStr(AddDayCount) {
        var dd = new Date();
        dd.setTime(dd.getTime() + AddDayCount * 24 * 60 * 60 * 1000); //获取AddDayCount天后的日期
        var y = dd.getFullYear();
        var m = dd.getMonth() + 1; //获取当前月份的日期 
        var d = dd.getDate();
        return y + "-" + m + "-" + d;
    }
</script>

</html>