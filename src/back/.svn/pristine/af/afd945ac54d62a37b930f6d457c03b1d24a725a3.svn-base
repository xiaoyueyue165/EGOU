<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">

<head>
  <title></title>
  <meta charset="utf-8">
  <meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
  <link rel="stylesheet" href="../build/css/fonts/font-awesome.min.css">
  <link rel="stylesheet" href="../build/css/ui-box.css">
  <link rel="stylesheet" href="../build/css/ui-base.css">
  <link rel="stylesheet" href="../build/css/ui-color.css">
  <link rel="stylesheet" href="../build/css/appcan.icon.css">
  <link rel="stylesheet" href="../build/css/appcan.control.css">
  <link rel="stylesheet" href="../intention/css/intention.css" />
  <style>
    #cusCompany,
    #cusCompany1,
    #cusCompany2 {
      width: 7em;
      border: 0;
      outline: 0;
      -webkit-appearance: none;
      font: 1.2em;
      background-color: transparent;
    }

    .dateInp {
      margin-left: 0.4em;
      box-sizing: border-box;
      width: 6.6em;
      height: 2em;
      -webkit-appearance: none;
      background: #fff;
      text-decoration: none;
      font-size: 1em;
      outline: 0;
    }
  </style>
</head>

<body class="pop-body" ontouchstart>

  <div class="pop-wrapper">
    <div class="pop-content">
      <form id="formData">
        <div class="pop-info">
          <label for="cusName">销售公司：</label>

          <select id="gyfgsSelect" name="orgId" class="mySelect"></select>

        </div>

        <!-- <div class="pop-info">
          <span class="test">开始时间:</span>
          <input id="date1" class="Abtn dateInp timeBtn" type="button">
        </div>
        <div class="pop-info">
          <span class="test">结束时间:</span>
          <input id="date2" class=" dateInp timeBtn" type="button">
        </div> -->


      </form>

      <div id="btn" class="ub ub-ac">
        <div id="confirmBtn" class="uinn5 ubt ubr bc-border ub ub-f1 ub-pc">
          <span class="bc-color">查询</span>
        </div>
        <div id="cancelBtn" class="uinn5 ubt bc-border ub ub-f1 ub-pc">
          <span class="bc-color">关闭</span>
        </div>
      </div>
    </div>
  </div>
</body>

<script src="../build/js/appcan.js"></script>
<script src="../build/js/appcan.control.js"></script>
<script src="../common/common.js"></script>
<script src="../common/jquery.min.js"></script>
<script src="../common/template-web.js"></script>
<script id="gyfgs" type="text/html">

  {{each list}}
  <option value={{$value.orgId}}>{{$value.orgNameEasy ||orgName}}</option>
  {{/each}}

</script>

<script>
  var SelectData = {
    "gyfgs": []
  }
  // 分页参数传递
  var pagerParam = {

  }
  getGYFGS();

  appcan.ready(function () {
    appcan.initBounce();
    // 销售公司=》购油分公司
    var html1 = template('gyfgs', {
      list: SelectData.gyfgs
    })

    $("#gyfgsSelect").html(html1);
    $("#gyfgsSelect").prepend("<option value=''>请选择</option>");
  })

  // + "&getDate1=" + minDate + "&getDate2=" + maxDate;
  function getGYFGS() {
    var paramJsonStr = "&pager.pageNo=" + pageNo + "&pager.pageSize=" + 100;
    var func = GYFGS;
    syncLoadData(URL + "/backgrd/bilOutstorePlan/selectERPCompany", paramJsonStr, func);
  }

  function GYFGS(data) {
    SelectData.gyfgs = JSON.parse(data);
  }

  appcan.button("#confirmBtn", "act-ani", function () {

    var orgId = appcan.locStorage.getVal("orgId");
    var companyType = appcan.locStorage.getVal("companyType");
    var baseParam = serialize(document.getElementById(
      "formData")) + "&pager.pageSize=" + pageSize;
    var paramJsonStr = baseParam + "&pager.pageNo=" + pageNo +
      "&pager.pageSize=" + pageSize;
    var func = showOrderCallback;
    var url = null;
    if (companyType == '全资') {
      url = URL + "/app/oil/order/selectOrderListForQuanZi"
    } else if (companyType == '合资' || companyType == '总部') {
      url = URL + "/app/oil/order/selectOrderList";
    } else {
      oneAlert("客户类型并非全资，合资，总公司客户，请向维护人员反馈");
      return;
    }
    pagerParam["baseParam"] = baseParam;

    pagerParam["pager.pageNo"] = 1;
    pagerParam["url"] = url;

    ajaxPostQuery(url, paramJsonStr, func, "text");

    appcan.window.openToast('加载中...', '0', '5', '1');
  })

  function showOrderCallback(data) {
    setTimeout(function () {
      closeToast();
      if (typeof data === "string" && data != '') {
        var result = JSON.parse(data);
        var rows = result.rows;
        if (rows && rows.length > 0) {
          var obj = {
            "type": "order",
            "data": rows
          }

          appcan.locStorage.setVal("searchData", obj);

          if (rows.length > pageNo) {
            pagerParam["pager.totalRows"] = result["pager.totalRows"];
            setVal("pagerParam", pagerParam);
          } else {
            appcan.locStorage.remove("pagerParam");
          }

        } else {
          appcan.locStorage.setVal("searchData", 0);
        }
      } else {
        appcan.locStorage.setVal("searchData", 0)
      }
      appcan.window.publish("search", "true");
      closepop();
    }, 1000);
  }

  appcan.button("#cancelBtn", "act-ani", function () {
    closepop();
  })

  //关闭浮动窗口
  function closepop() {
    appcan.closePopover("searchForOrder");
  }
</script>
<script src="../build/mui-dtpicker/js/mui.min.js"></script>
<script src="../build/mui-dtpicker/js/mui.picker.all.js"></script>
<script type="text/javascript" charset="utf-8">
  (function ($) {
    $.init();
    var result = document.querySelectorAll(".timeBtn");
    var btns = $('.timeBtn');
    btns.each(function (i, btn) {
      btn.addEventListener('tap', function () {
        var _self = this;
        if (_self.picker) {
          _self.picker.show(function (rs) {

            result[i].value = rs.text;
            var chooseDate = (rs.text).split(" ")[0];
            var chooseTime = (rs.text).split(" ")[1];
            appcan.locStorage.setVal("chooseDate", chooseDate)
            appcan.locStorage.setVal("chooseTime", chooseTime)
            _self.picker = null;
          });
        } else {
          var date = new Date().formate("yyyy-MM-dd"),
            y = date.split("-")[0];

          var options = {
            type: "date", //设置日历初始视图模式
            beginYear: y - 5, //设置开始日期
            endYear: y, //设置结束日期
            labels: ["年", "月", "日"], //设置默认标签区域提示语
          }
          var id = this.getAttribute('id');

          _self.picker = new $.DtPicker(options);
          _self.picker.show(function (rs) {

            result[i].value = rs.text;
            var chooseDate = (rs.text).split(" ")[0];
            var chooseTime = (rs.text).split(" ")[1];
            appcan.locStorage.setVal("chooseDate", chooseDate)
            appcan.locStorage.setVal("chooseTime", chooseTime)

            _self.picker = null;
          });
        }

      }, false);
    });
  })(mui);
</script>

</html>